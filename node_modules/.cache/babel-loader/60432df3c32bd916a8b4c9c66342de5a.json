{"ast":null,"code":"import _regeneratorRuntime from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _asyncToGenerator from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/inherits\";/* eslint-disable react/button-has-type */ /* eslint-disable jsx-a11y/label-has-associated-control */import React from'react';import{Redirect}from'react-router';import'./formulaireGerePret.css';import{MDBContainer,MDBRow,MDBCard,MDBCardBody}from'mdbreact';import axios from'axios';var LendBook=/*#__PURE__*/function(_React$Component){_inherits(LendBook,_React$Component);function LendBook(props){var _this;_classCallCheck(this,LendBook);_this=_possibleConstructorReturn(this,_getPrototypeOf(LendBook).call(this,props));_this.change=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _this.setState(_defineProperty({},e.target.id,e.target.value));case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handleSubmitLend=function(e){var _this$state=_this.state,title=_this$state.title,author=_this$state.author,borrower=_this$state.borrower,borrowDate=_this$state.borrowDate;//cas ou tous les champs sont remplis\nif(title&&author&&borrower&&borrowDate){console.log(_this.state);var formData=new FormData();formData.append(\"title\",_this.state.title);formData.append(\"author\",_this.state.author);formData.append(\"borrower\",_this.state.borrower);formData.append(\"borrowDate\",_this.state.borrowDate);var url=\"http://localhost:8888/API/AjouterPret/ajout_pret.php\";axios.post(url,formData,{withCredentials:true})//succès enregistrer prêt\n.then(function(response){this.setState({registeredLend:true});console.log(response);alert('Prêt enregistré');}.bind(_assertThisInitialized(_this)))//echec enregistrer prêt \n.catch(function(error){if(error.response&&error.response.status===403){console.log(error);alert(error.response.data);}});}else{//cas ou les champs ne sont pas remplis\n_this.setState({error:'Veuillez saisir tous les champs !'});}setTimeout(function(){_this.setState({error:''});},2000);e.preventDefault();};_this.state={noSession:false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\ntitle:null,//va contenir la valeur entrée pour le champs \"titre\" du formulaire\nauthor:null,//va contenir la valeur entrée pour le champs \"auteur\" du formulaire\nborrower:null,//va contenir la valeur entrée pour le champs \"emprunteur\" du formulaire\nborrowDate:null,//va contenir la valeur entrée pour le champs \"date d'emprunt\" du formulaire\nregisteredLend:false,//initialise le statut de redirection comme faux\nerror:''//va contenir l'erreur en cas d'erreur\n};_this.checkSession=_this.checkSession.bind(_assertThisInitialized(_this));return _this;}//Vérifie que la session est active\n_createClass(LendBook,[{key:\"checkSession\",value:function checkSession(){var _this2=this;axios.get(\"http://localhost:8888/API/Session/session.php\",{withCredentials:true}).then(function(response){console.log(response);}).catch(function(error){if(error.response&&error.response.status===404){_this2.setState({noSession:true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\nconsole.log(error);}});}//methode qui permet d'attribuer à \"title\", \"author\", \"borrower\" et \"borrowDate\" les valeurs entrées au clavier par l'utilisateur\n},{key:\"render\",value:function render(){var error=this.state.error;var container={height:800};var registeredLend=this.state.registeredLend;var noSession=this.state.noSession;//appel à la methode qui verifie la session\nthis.checkSession();//s'il n'y a pas de session active, redirection vers la page de connexion\nif(noSession){return React.createElement(Redirect,{to:\"/\"});}//redirection vers la page des prêts si le prêt a été enregistré correctement\nif(registeredLend){return React.createElement(Redirect,{to:\"/mesPrets\"});}//affichage du formulaire de prêt a completer par l'utilisateur\n//affichage du bouton \"valider\" en fin de formulaire\nreturn React.createElement(MDBContainer,{style:container,className:\"containerGerePret\"},React.createElement(MDBRow,null,React.createElement(\"div\",{className:\"colGerePret\"},React.createElement(MDBCard,null,React.createElement(MDBCardBody,null,React.createElement(\"form\",{onSubmit:this.handleSubmitLend,className:\"form\"},React.createElement(\"div\",{className:\"text-center\"},React.createElement(\"h2\",{className:\"dark-grey-text mb-5\"},\"Ajouter un pr\\xEAt\")),React.createElement(\"div\",{className:\"grey-text\"},React.createElement(\"label\",{htmlFor:\"title\",className:\"grey-text\"},\"Titre\"),React.createElement(\"input\",{type:\"text\",id:\"title\",placeholder:\"Titre\",className:\"form-control\",onChange:this.change,required:true}),React.createElement(\"br\",null),React.createElement(\"label\",{htmlFor:\"author\",className:\"grey-text\"},\"Auteur\"),React.createElement(\"input\",{type:\"text\",id:\"author\",placeholder:\"Auteur\",className:\"form-control\",onChange:this.change,required:true}),React.createElement(\"br\",null),React.createElement(\"label\",{htmlFor:\"borrower\",className:\"grey-text\"},\"Emprunteur\"),React.createElement(\"input\",{type:\"text\",id:\"borrower\",placeholder:\"Nom de l'emprunteur\",className:\"form-control\",onChange:this.change,required:true}),React.createElement(\"br\",null),React.createElement(\"label\",{htmlFor:\"borrowDate\",className:\"grey-text\"},\"Date d'emprunt\"),React.createElement(\"input\",{type:\"date\",id:\"borrowDate\",placeholder:\"jj/mm/aa\",className:\"form-control\",onChange:this.change,required:true})),React.createElement(\"div\",{className:\"text-center py-4 mt-3\"},React.createElement(\"button\",{className:\"btn btn-primary\",onClick:this.handleSubmitLend,type:\"submit\"},\"Valider\"),error&&React.createElement(\"p\",{className:\"error\"},error))))))));}}]);return LendBook;}(React.Component);export default LendBook;","map":{"version":3,"sources":["/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/src/components/GerePret/formulaireGerePret.js"],"names":["React","Redirect","MDBContainer","MDBRow","MDBCard","MDBCardBody","axios","LendBook","props","change","e","setState","target","id","value","handleSubmitLend","state","title","author","borrower","borrowDate","console","log","formData","FormData","append","url","post","withCredentials","then","response","registeredLend","alert","bind","catch","error","status","data","setTimeout","preventDefault","noSession","checkSession","get","container","height","Component"],"mappings":"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","sourcesContent":["/* eslint-disable react/button-has-type */\n/* eslint-disable jsx-a11y/label-has-associated-control */\nimport React from 'react';\nimport { Redirect} from 'react-router';\nimport './formulaireGerePret.css';\nimport {\n  MDBContainer, MDBRow, MDBCard, MDBCardBody,\n} from 'mdbreact';\nimport axios from 'axios';\n\n\nclass LendBook extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      noSession: false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\n      title: null,//va contenir la valeur entrée pour le champs \"titre\" du formulaire\n      author: null,//va contenir la valeur entrée pour le champs \"auteur\" du formulaire\n      borrower: null,//va contenir la valeur entrée pour le champs \"emprunteur\" du formulaire\n      borrowDate: null,//va contenir la valeur entrée pour le champs \"date d'emprunt\" du formulaire\n      registeredLend: false,//initialise le statut de redirection comme faux\n      error: '',//va contenir l'erreur en cas d'erreur\n\n    }\n    this.checkSession = this.checkSession.bind(this);\n  }\n\n  //Vérifie que la session est active\n  checkSession () {\n    axios.get(\"http://localhost:8888/API/Session/session.php\", {withCredentials: true})\n\n    .then(function(response){\n      console.log(response);\n    })\n\n    .catch((error) => {\n      if(error.response && error.response.status=== 404){\n        this.setState({noSession: true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\n        console.log(error);\n      }\n    });\n  }\n\n  //methode qui permet d'attribuer à \"title\", \"author\", \"borrower\" et \"borrowDate\" les valeurs entrées au clavier par l'utilisateur\n  change = async e => {\n    await this.setState({\n      [e.target.id]: e.target.value,\n    });\n  }\n\n  //methode qui permet d'envoyer les données au fichier PHP \"ajout_pret.php\" afin d'enregistrer le prêt, lorque l'utilisateur appuie sur le bouton \"valider\"\n  handleSubmitLend = e => {\n\n    const {\n      title, author, borrower, borrowDate,\n    } = this.state;\n    //cas ou tous les champs sont remplis\n    if (title && author && borrower && borrowDate) {\n\n        \n        console.log(this.state);\n        let formData = new FormData();\n        formData.append(\"title\",this.state.title);\n        formData.append(\"author\",this.state.author);\n        formData.append(\"borrower\",this.state.borrower);\n        formData.append(\"borrowDate\",this.state.borrowDate);\n        const url = \"http://localhost:8888/API/AjouterPret/ajout_pret.php\";\n        axios.post(url,formData, {withCredentials: true})\n\n        //succès enregistrer prêt\n        .then(function(response){\n          this.setState({registeredLend:true});\n          console.log(response);\n          alert('Prêt enregistré');\n        }.bind(this))\n\n        //echec enregistrer prêt \n        .catch((error) => {\n          if (error.response && error.response.status === 403){\n            console.log(error);\n            alert(error.response.data);\n          }\n        });\n\n        \n    } else {\n      //cas ou les champs ne sont pas remplis\n      this.setState({\n        error: 'Veuillez saisir tous les champs !',\n      });\n    }\n    setTimeout(() => {\n      this.setState({\n        error: '',\n      });\n    }, 2000);\n          \n    e.preventDefault();\n  }\n\n  render() {\n    const { error } = this.state;\n    const container = {height: 800};\n    const {registeredLend} = this.state;\n    const {noSession} = this.state;\n\n    //appel à la methode qui verifie la session\n    this.checkSession ();\n\n    //s'il n'y a pas de session active, redirection vers la page de connexion\n    if(noSession){\n      return <Redirect to=\"/\"/>;\n    }\n\n    //redirection vers la page des prêts si le prêt a été enregistré correctement\n    if(registeredLend){\n      return <Redirect to=\"/mesPrets\"/>;\n    }\n\n    //affichage du formulaire de prêt a completer par l'utilisateur\n    //affichage du bouton \"valider\" en fin de formulaire\n    return (\n      <MDBContainer style={container} className=\"containerGerePret\">\n        <MDBRow>\n          <div className=\"colGerePret\">\n            <MDBCard>\n              <MDBCardBody>\n                <form onSubmit={this.handleSubmitLend} className=\"form\">\n                  <div className=\"text-center\">\n                    <h2 className=\"dark-grey-text mb-5\">\n                      Ajouter un prêt\n                    </h2>\n                  </div>\n                  <div className=\"grey-text\">\n                    <label htmlFor=\"title\" className=\"grey-text\">\n                      Titre\n                    </label>\n                    <input\n                      type=\"text\"\n                      id=\"title\"\n                      placeholder=\"Titre\"\n                      className=\"form-control\"\n                      onChange={this.change}\n                      required\n                    />\n\n                    <br />\n\n                    <label htmlFor=\"author\" className=\"grey-text\">\n                      Auteur\n                    </label>\n                    <input\n                      type=\"text\"\n                      id=\"author\"\n                      placeholder=\"Auteur\"\n                      className=\"form-control\"\n                      onChange={this.change}\n                      required\n                    />\n\n                    <br />\n\n                    <label htmlFor=\"borrower\" className=\"grey-text\">\n                      Emprunteur\n                    </label>\n                    <input\n                      type=\"text\"\n                      id=\"borrower\"\n                      placeholder=\"Nom de l'emprunteur\"\n                      className=\"form-control\"\n                      onChange={this.change}\n                      required\n                    />\n\n                    <br />\n\n                    <label htmlFor=\"borrowDate\" className=\"grey-text\">\n                      Date d&apos;emprunt\n                    </label>\n                    <input\n                      type=\"date\"\n                      id=\"borrowDate\"\n                      placeholder=\"jj/mm/aa\"\n                      className=\"form-control\"\n                      onChange={this.change}\n                      required\n                    />\n\n\n                  </div>\n                  <div className=\"text-center py-4 mt-3\">\n                    <button className=\"btn btn-primary\" onClick={this.handleSubmitLend} type=\"submit\">Valider</button>\n                    {\n                     error && (\n                     <p className=\"error\">{error}</p>\n                     )\n                    }\n                  </div>\n\n                </form>\n\n              </MDBCardBody>\n            </MDBCard>\n          </div>\n        </MDBRow>\n      </MDBContainer>\n\n    );\n  }\n}\nexport default LendBook;\n"]},"metadata":{},"sourceType":"module"}