{"ast":null,"code":"import _regeneratorRuntime from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Fragment}from\"react\";import{MDBBtn,MDBTableBody,MDBTableHead,MDBTable,MDBModal,MDBModalHeader,MDBModalBody,MDBModalFooter}from\"mdbreact\";import'./mesPrets.css';import axios from'axios';import{Redirect}from'react-router';var MyLends=/*#__PURE__*/function(_React$Component){_inherits(MyLends,_React$Component);function MyLends(props){var _this;_classCallCheck(this,MyLends);_this=_possibleConstructorReturn(this,_getPrototypeOf(MyLends).call(this,props));_this.openModalLend=function(id){return function(e){_this.setState({modal:true,idLend:id});};};_this.closeModalLend=function(){_this.setState({modal:false});};_this.change=function(e){_this.setState(_defineProperty({},e.target.name,e.target.value));};_this.returnBook=function(returnDate){return function(e){var _this$state=_this.state,idLend=_this$state.idLend,lends=_this$state.lends;var newBooks=lends;console.log(idLend,'idBookSubmit');_this.setState({modal:false});var formData=new FormData();formData.append(\"id\",idLend);formData.append(\"returnDate\",returnDate);var url=\"http://localhost:8888/API/GererPrets/rendu_pret.php\";axios.post(url,formData,{withCredentials:true})//succes rendu livre\n.then(function(response){console.log(response);var tmp=lends;newBooks=tmp.filter(function(livre){return livre.id!==idLend;});alert('Succès : Livre à nouveau marqué comme disponible');})//echec rendu livre\n.catch(function(error){console.log(error);if(error.response&&error.response.status===403){console.log(error);alert('Echec du rendu');}});setTimeout(function(){_this.setState({lends:newBooks});},500);setTimeout(function(){_this.setState({error:''});},2000);e.preventDefault();};};_this.state={noSession:false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\nloading:true,//booleen initialisé comme vrai, qui va changer lors de la récupération des données\nlends:[],//va contenir les prets en cours de l'utilisateur\nreturnDate:'',//va contenir la valeur entrée pour le champs \"date de rendu\" du formulaire, lorsuque l'utilisateur appuie sur le bouton \"rendu\"\nmodal:false,//booleen qui va permettre d'ouvrir/fermer une fenetre lorsque l'utilisateur appuie sur \"rendu\"\nid:'',//va contenir l'id du livre selectionné par l'utilisateur lorsqu'il appuiera sur le  bouton \"rendu\"\nerror:'',//va contenir l'erreur en cas d'erreur\nidLend:null//va contenir l'id du livre rendu\n};_this.checkSession=_this.checkSession.bind(_assertThisInitialized(_this));_this.returnBook=_this.returnBook.bind(_assertThisInitialized(_this));_this.openModalLend=_this.openModalLend.bind(_assertThisInitialized(_this));return _this;}//Vérifie que la session est active\n_createClass(MyLends,[{key:\"checkSession\",value:function checkSession(){var _this2=this;axios.get(\"http://localhost:8888/API/Session/session.php\",{withCredentials:true}).then(function(response){console.log(response);}).catch(function(error){if(error.response&&error.response.status===404){_this2.setState({noSession:true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\nconsole.log(error);}});}//methode qui permet d'ouvrir une fenetre avec un champs pour remplir la date de rendu du livre prêté\n},{key:\"componentDidMount\",//methode qui permet de récuperer les livres en cours de prêts de l'utilisateur via le fichier \"liste_prets.php\"     \nvalue:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var url,response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:url=\"http://localhost:8888/API/GererPrets/liste_prets.php\";_context.next=3;return fetch(url,{credentials:'include'});case 3:response=_context.sent;_context.next=6;return response.json();case 6:data=_context.sent;this.setState({lends:data.results.livres,loading:false});//\"lends\" contient les données reçues par le back-end \nconsole.log(data.results.livres);case 9:case\"end\":return _context.stop();}}},_callee,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this3=this;var noSession=this.state.noSession;//appel à la methode qui verifie la session\nthis.checkSession();//s'il n'y a pas de session active, redirection vers la page de connexion\nif(noSession){return React.createElement(Redirect,{to:\"/\"});}//si le temps de récupération des données a afficher est long\nif(this.state.loading){return React.createElement(\"div\",null,\"chargement...\");}//si l'utilisateur n'a pas de prêts en cours:\n//affichage d'un bouton \"nouveau prêt\" qui redirige vers le formulaire de prêt\n//affichage d'un bouton \"historique des prêts\" qui redirige vers l'historique des prêts\nif(this.state.lends.length===0){return React.createElement(\"div\",null,React.createElement(\"h1\",{className:\"titleMyLends\"},\" Mes pr\\xEAts \"),React.createElement(\"div\",{className:\"noLend\"},\"Vous n'avez actuellement aucun pr\\xEAt en cours.\"),React.createElement(\"div\",{className:\"buttonGere\"},React.createElement(Fragment,null,React.createElement(MDBBtn,{href:\"/formulaireGerePret\",color:\"dark\"},\"Nouveau pr\\xEAt\"))),React.createElement(\"div\",{className:\"buttonHistoric\"},React.createElement(Fragment,null,React.createElement(MDBBtn,{href:\"/historique\",color:\"dark\"},\"Historique des pr\\xEAts\"))));}//sinon:\n//affichage d'un tableau avec les prêts en cours de l'utilisateur, grâce a la fonction map qui va parcourir \"lends\"\n//affichage d'un bouton \"rendu\" sur chaque ligne du tableau\n//affichage d'un bouton \"nouveau prêt\" qui redirige vers le formulaire de prêt\n//affichage d'un bouton \"historique des prêts\" qui redirige vers l'historique des prêts\n//ouverture d'une fenetre avec le formulaire de rendu lorsque l'utilisateur appuie sur \"rendu\"\nreturn React.createElement(\"div\",null,React.createElement(\"h1\",{className:\"titleMyLends\"},\" Mes pr\\xEAts \"),React.createElement(\"br\",null),React.createElement(\"h2\",null,\" Vous avez \",this.state.lends.length,\" pr\\xEAt(s) en cours:\"),React.createElement(\"br\",null),React.createElement(MDBTable,{hover:true,bordered:true,scrollY:true,maxHeight:\"350px\"},React.createElement(MDBTableHead,null,React.createElement(\"tr\",null,React.createElement(\"th\",null,\"Titre\"),React.createElement(\"th\",null,\"Auteur\"),React.createElement(\"th\",null,\"Emprunteur\"),React.createElement(\"th\",null,\"Date d'emprunt\"),React.createElement(\"th\",null))),React.createElement(MDBTableBody,null,this.state.lends.map(function(livre){return React.createElement(\"tr\",{key:livre.id},React.createElement(\"td\",null,livre.title),React.createElement(\"td\",null,livre.author),React.createElement(\"td\",null,livre.borrower),React.createElement(\"td\",null,livre.borrowDate),React.createElement(\"td\",null,React.createElement(MDBBtn,{onClick:_this3.openModalLend(livre.id),color:\"dark\"},\"Rendu\"),React.createElement(MDBModal,{isOpen:_this3.state.modal},React.createElement(MDBModalHeader,null,\"Date de rendu\"),React.createElement(MDBModalBody,null,React.createElement(\"input\",{type:\"date\",name:\"returnDate\",placeholder:\"jj/mm/aa\",className:\"form-control\",onChange:function onChange(e){return _this3.change(e);}})),React.createElement(MDBModalFooter,null,React.createElement(MDBBtn,{color:\"danger\",onClick:_this3.closeModalLend},\"Annuler\"),React.createElement(MDBBtn,{color:\"dark\",onClick:_this3.returnBook(_this3.state.returnDate)},\"Enregistrer\")))));}))),React.createElement(\"div\",{className:\"buttonGere\"},React.createElement(Fragment,null,React.createElement(MDBBtn,{href:\"/formulaireGerePret\",color:\"dark\"},\"Nouveau pr\\xEAt\"))),React.createElement(\"div\",{className:\"buttonHistoric\"},React.createElement(Fragment,null,React.createElement(MDBBtn,{href:\"/historique\",color:\"dark\"},\"Historique des pr\\xEAts\"))));}}]);return MyLends;}(React.Component);export default MyLends;","map":{"version":3,"sources":["/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/src/components/MesPrets/mesPrets.js"],"names":["React","Fragment","MDBBtn","MDBTableBody","MDBTableHead","MDBTable","MDBModal","MDBModalHeader","MDBModalBody","MDBModalFooter","axios","Redirect","MyLends","props","openModalLend","id","e","setState","modal","idLend","closeModalLend","change","target","name","value","returnBook","returnDate","state","lends","newBooks","console","log","formData","FormData","append","url","post","withCredentials","then","response","tmp","filter","livre","alert","catch","error","status","setTimeout","preventDefault","noSession","loading","checkSession","bind","get","fetch","credentials","json","data","results","livres","length","map","title","author","borrower","borrowDate","Component"],"mappings":"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","sourcesContent":["import React, { Fragment } from \"react\";\nimport { MDBBtn, MDBTableBody, MDBTableHead, MDBTable, MDBModal, MDBModalHeader, MDBModalBody, MDBModalFooter} from \"mdbreact\";\nimport './mesPrets.css';\nimport axios from 'axios';\nimport { Redirect} from 'react-router';\n\nclass MyLends extends React.Component{\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      noSession: false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\n      loading: true,//booleen initialisé comme vrai, qui va changer lors de la récupération des données\n      lends: [],//va contenir les prets en cours de l'utilisateur\n      returnDate: '',//va contenir la valeur entrée pour le champs \"date de rendu\" du formulaire, lorsuque l'utilisateur appuie sur le bouton \"rendu\"\n      modal: false,//booleen qui va permettre d'ouvrir/fermer une fenetre lorsque l'utilisateur appuie sur \"rendu\"\n      id: '',//va contenir l'id du livre selectionné par l'utilisateur lorsqu'il appuiera sur le  bouton \"rendu\"\n      error:'',//va contenir l'erreur en cas d'erreur\n      idLend: null,//va contenir l'id du livre rendu\n    }\n    this.checkSession = this.checkSession.bind(this);\n    this.returnBook = this.returnBook.bind(this);\n    this.openModalLend = this.openModalLend.bind(this);\n  }\n\n  //Vérifie que la session est active\n  checkSession () {\n    axios.get(\"http://localhost:8888/API/Session/session.php\", {withCredentials: true})\n\n    .then(function(response){\n      console.log(response);\n    })\n\n    .catch((error) => {\n      if(error.response && error.response.status=== 404){\n        this.setState({noSession: true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\n        console.log(error);\n      }\n    });\n  }\n\n  //methode qui permet d'ouvrir une fenetre avec un champs pour remplir la date de rendu du livre prêté\n  openModalLend = (id) => e => {\n    this.setState({\n      modal: true,\n      idLend: id\n    });\n  }\n\n  //methode qui permet de fermer la fenetre de rendu d'un livre\n  closeModalLend = () => {\n  this.setState({\n    modal: false,\n  });\n}\n\n\n//methode qui permet d'attribuer à \"returnDate\" la valeur entrée au clavier par l'utilisateur lors du rendu d'un prêt\nchange = e => {\n  this.setState ({\n    [e.target.name]: e.target.value\n  });\n};\n\n//methode qui permet d'envoyer les données au fichier PHP \"rendu_pret.php\" afin de modifier le statut du livre prêté, lorque l'utilisateur appuie sur le bouton \"enregistrer\" de la fenetre de rendu\nreturnBook = (returnDate) => e => {\n\n  const { idLend, lends } = this.state;\n  let newBooks = lends;\n  console.log(idLend,'idBookSubmit');\n  this.setState({\n    modal: false,\n  })\n  let formData = new FormData();\n  formData.append(\"id\",idLend);\n  formData.append(\"returnDate\",returnDate);\n  const url = \"http://localhost:8888/API/GererPrets/rendu_pret.php\"\n  axios.post(url, formData, {withCredentials: true})\n  \n  //succes rendu livre\n  .then(function(response){\n    console.log(response);\n    const tmp = lends;\n    newBooks = tmp.filter(livre => livre.id !== idLend);\n    alert('Succès : Livre à nouveau marqué comme disponible');\n  })\n\n  //echec rendu livre\n  .catch((error)=>{\n    console.log(error)\n    if (error.response && error.response.status === 403){\n      console.log(error);\n      alert('Echec du rendu');\n    }\n  });\n\n  setTimeout(() => {\n    this.setState({\n      lends: newBooks\n    })\n  }, 500);\n  \n\n  setTimeout(() => {\n    this.setState({\n      error: '',\n    });\n  }, 2000);\n        \n  e.preventDefault();\n\n}\n\n//methode qui permet de récuperer les livres en cours de prêts de l'utilisateur via le fichier \"liste_prets.php\"     \nasync componentDidMount() {\n    const url = \"http://localhost:8888/API/GererPrets/liste_prets.php\";\n    const response = await fetch(url,{credentials: 'include'});\n    const data = await response.json();\n    this.setState({lends: data.results.livres, loading: false})//\"lends\" contient les données reçues par le back-end \n    console.log(data.results.livres);\n}\n\nrender() {\n  const {noSession} = this.state;\n\n  //appel à la methode qui verifie la session\n  this.checkSession ();\n\n  //s'il n'y a pas de session active, redirection vers la page de connexion\n  if(noSession){\n    return <Redirect to=\"/\"/>;\n  }\n\n    //si le temps de récupération des données a afficher est long\n    if(this.state.loading){\n        return <div>chargement...</div>;\n    }\n\n    //si l'utilisateur n'a pas de prêts en cours:\n    //affichage d'un bouton \"nouveau prêt\" qui redirige vers le formulaire de prêt\n    //affichage d'un bouton \"historique des prêts\" qui redirige vers l'historique des prêts\n    if (this.state.lends.length === 0){\n        return (\n          <div>\n            <h1 className=\"titleMyLends\"> Mes prêts </h1>\n            <div className=\"noLend\">\n              Vous n'avez actuellement aucun prêt en cours.\n            </div>\n            <div className=\"buttonGere\">\n                <Fragment>\n                    <MDBBtn href=\"/formulaireGerePret\" color=\"dark\"> \n                        Nouveau prêt\n                    </MDBBtn>\n                </Fragment>\n            </div>\n            <div className=\"buttonHistoric\">\n                <Fragment>\n                    <MDBBtn href=\"/historique\" color=\"dark\"> \n                        Historique des prêts\n                    </MDBBtn>\n                </Fragment>\n                \n          </div>  \n          </div>  \n        );\n    } \n\n    //sinon:\n    //affichage d'un tableau avec les prêts en cours de l'utilisateur, grâce a la fonction map qui va parcourir \"lends\"\n    //affichage d'un bouton \"rendu\" sur chaque ligne du tableau\n    //affichage d'un bouton \"nouveau prêt\" qui redirige vers le formulaire de prêt\n    //affichage d'un bouton \"historique des prêts\" qui redirige vers l'historique des prêts\n    //ouverture d'une fenetre avec le formulaire de rendu lorsque l'utilisateur appuie sur \"rendu\"\n    return (\n        <div>\n          <h1 className=\"titleMyLends\"> Mes prêts </h1>\n          <br></br>\n          <h2> Vous avez {this.state.lends.length} prêt(s) en cours:</h2>\n          <br></br>\n          <MDBTable hover bordered scrollY maxHeight=\"350px\">\n            <MDBTableHead>\n              <tr>\n              <th>Titre</th>\n              <th>Auteur</th>\n              <th>Emprunteur</th>\n              <th>Date d'emprunt</th>\n              <th></th>\n              </tr>\n            </MDBTableHead>\n            <MDBTableBody>\n              {\n                this.state.lends.map(livre => (\n                  <tr key={livre.id} >\n                    <td>{livre.title}</td>\n                    <td>{livre.author}</td>\n                    <td>{livre.borrower}</td>\n                    <td>{livre.borrowDate}</td>\n                    <td><MDBBtn onClick={this.openModalLend(livre.id)} color=\"dark\">Rendu</MDBBtn>\n                        <MDBModal isOpen={this.state.modal}>\n                          <MDBModalHeader>Date de rendu</MDBModalHeader>\n                          <MDBModalBody>\n                            <input\n                              type=\"date\"\n                              name=\"returnDate\"\n                              placeholder=\"jj/mm/aa\"\n                              className=\"form-control\"\n                              onChange={e => this.change(e)}\n                            />\n                          </MDBModalBody>\n                          <MDBModalFooter>\n                            <MDBBtn color=\"danger\" onClick={this.closeModalLend}>Annuler</MDBBtn>\n                            <MDBBtn color=\"dark\" onClick={this.returnBook(this.state.returnDate)}>Enregistrer</MDBBtn>\n                          </MDBModalFooter>\n                        </MDBModal>\n                    \n                    \n                    </td>\n                  </tr>\n                ))\n              }\n            </MDBTableBody>\n          </MDBTable>\n          <div className=\"buttonGere\">\n                <Fragment>\n                    <MDBBtn href=\"/formulaireGerePret\" color=\"dark\"> \n                        Nouveau prêt\n                    </MDBBtn>\n                </Fragment>\n                \n          </div>\n          <div className=\"buttonHistoric\">\n                <Fragment>\n                    <MDBBtn href=\"/historique\" color=\"dark\"> \n                        Historique des prêts\n                    </MDBBtn>\n                </Fragment>\n                \n          </div>  \n        </div>\n      );\n    }\n}\n\nexport default MyLends;"]},"metadata":{},"sourceType":"module"}