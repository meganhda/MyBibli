{"ast":null,"code":"import _regeneratorRuntime from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/inherits\";import React from\"react\";import'./monCompte.css';import{MDBTableBody,MDBTable,MDBBtn}from\"mdbreact\";import axios from'axios';import{Redirect}from'react-router';var MyAccount=/*#__PURE__*/function(_React$Component){_inherits(MyAccount,_React$Component);function MyAccount(props){var _this;_classCallCheck(this,MyAccount);_this=_possibleConstructorReturn(this,_getPrototypeOf(MyAccount).call(this,props));_this.handleChangeFirstName=function(event){_this.setState({firstName:event.target.value});};_this.handleChangeLastName=function(event){_this.setState({lastName:event.target.value});};_this.handleSubmitFirstName=function(firstName){return function(e){var formData=new FormData();formData.append(\"firstname\",firstName);var url=\"http://localhost:8888/API/MonCompte/modifier_firstname.php\";axios.post(url,formData,{withCredentials:true})//succes modification prénom\n.then(function(response){console.log(response.status,response);alert('Modification du prénom enregistrée');})//echec modification prénom\n.catch(function(error){console.log(error);if(error.response&&error.response.status===403){console.log(error);alert('Echec modification');}});setTimeout(function(){_this.setState({error:''});},2000);e.preventDefault();};};_this.handleSubmitLastName=function(lastName){return function(e){var formData=new FormData();formData.append(\"lastname\",lastName);var url=\"http://localhost:8888/API/MonCompte/modifier_lastname.php\";axios.post(url,formData,{withCredentials:true})//succes modification nom\n.then(function(response){console.log(response.status,response);alert('Modification du nom enregistrée');})//echec modification nom\n.catch(function(error){console.log(error);if(error.response&&error.response.status===403){console.log(error);alert('Echec modification');}});setTimeout(function(){_this.setState({error:''});},2000);e.preventDefault();};};_this.state={noSession:false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\ninformations:[],//va contenir les informations de l'utilisateur\nloading:true,//booleen initialisé comme vrai, qui va changer lors de la récupération des données\nerror:'',//va contenir l'erreur en cas d'erreur\nfirstName:undefined,//va contenir la nouvelle valeur du prenom entrée pour le champs \"prenom\"\nlastName:undefined//va contenir la nouvelle valeur du nom entrée pour le champs \"nom\"\n};_this.checkSession=_this.checkSession.bind(_assertThisInitialized(_this));return _this;}//Vérifie que la session est active\n_createClass(MyAccount,[{key:\"checkSession\",value:function checkSession(){var _this2=this;axios.get(\"http://localhost:8888/API/Session/session.php\",{withCredentials:true}).then(function(response){console.log(response);}).catch(function(error){if(error.response&&error.response.status===404){_this2.setState({noSession:true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\nconsole.log(error);}});}//methode qui permet d'attribuer à \"firstName\" la valeur entrée au clavier par l'utilisateur\n},{key:\"componentDidMount\",//methode qui permet de récuperer les linformations de l'utilisateur via le fichier \"mon_compte.php\"     \nvalue:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var url,response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:url=\"http://localhost:8888/API/MonCompte/mon_compte.php\";_context.next=3;return fetch(url,{credentials:'include'});case 3:response=_context.sent;_context.next=6;return response.json();case 6:data=_context.sent;this.setState({informations:data.results.profile[0],//\"informations\" contient les données reçues par le back-end \nloading:false//booleen \"loading\" changé comme \"faux\"\n});console.log(data.results.profile);case 9:case\"end\":return _context.stop();}}},_callee,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,firstName=_this$state.firstName,lastName=_this$state.lastName,informations=_this$state.informations;var noSession=this.state.noSession;//appel à la methode qui verifie la session\nthis.checkSession();//s'il n'y a pas de session active, redirection vers la page de connexion\nif(noSession){return React.createElement(Redirect,{to:\"/\"});}//si le temps de récupération des données a afficher est long\nif(this.state.loading){return React.createElement(\"div\",null,\"chargement...\");}//affichage des informations de l'utilisateur\n//affichage des champs a remplir si l'utilisateur veut modifier ses donnees\n//affichage des boutons \"modifier\"\nreturn React.createElement(\"div\",null,React.createElement(\"h1\",{className:\"titleMyAccount\"},\"Mes informations personnelles\"),React.createElement(MDBTable,{hover:true,bordered:true,maxHeight:\"350px\"},React.createElement(MDBTableBody,null,React.createElement(\"tr\",null,React.createElement(\"td\",null,\"Adresse email : \",informations.email)),React.createElement(\"tr\",null,React.createElement(\"td\",null,\"Pr\\xE9nom :\",React.createElement(\"br\",null),React.createElement(\"input\",{className:\"inputModif\",value:firstName,defaultValue:informations.firstname,onChange:function onChange(e){return _this3.handleChangeFirstName(e);}}),React.createElement(MDBBtn,{color:\"dark\",onClick:this.handleSubmitFirstName(this.state.firstName)},\"Modifier\"))),React.createElement(\"tr\",null,React.createElement(\"td\",null,\"Nom :\",React.createElement(\"br\",null),React.createElement(\"input\",{className:\"inputModif\",value:lastName,defaultValue:informations.lastname,onChange:function onChange(e){return _this3.handleChangeLastName(e);}}),React.createElement(MDBBtn,{color:\"dark\",onClick:this.handleSubmitLastName(this.state.lastName)},\"Modifier\"))))));}}]);return MyAccount;}(React.Component);export default MyAccount;","map":{"version":3,"sources":["/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/src/components/MonCompte/monCompte.js"],"names":["React","MDBTableBody","MDBTable","MDBBtn","axios","Redirect","MyAccount","props","handleChangeFirstName","event","setState","firstName","target","value","handleChangeLastName","lastName","handleSubmitFirstName","e","formData","FormData","append","url","post","withCredentials","then","response","console","log","status","alert","catch","error","setTimeout","preventDefault","handleSubmitLastName","state","noSession","informations","loading","undefined","checkSession","bind","get","fetch","credentials","json","data","results","profile","email","firstname","lastname","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport './monCompte.css';\nimport { MDBTableBody, MDBTable, MDBBtn } from \"mdbreact\";\nimport axios from 'axios';\nimport { Redirect} from 'react-router';\n\n\nclass MyAccount extends React.Component {\n\n    constructor(props){\n        super(props);\n        this.state ={\n            noSession: false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\n            informations: [],//va contenir les informations de l'utilisateur\n            loading: true,//booleen initialisé comme vrai, qui va changer lors de la récupération des données\n            error:'',//va contenir l'erreur en cas d'erreur\n            firstName: undefined,//va contenir la nouvelle valeur du prenom entrée pour le champs \"prenom\"\n            lastName:undefined,//va contenir la nouvelle valeur du nom entrée pour le champs \"nom\"\n        }\n        this.checkSession = this.checkSession.bind(this);\n    }\n\n    //Vérifie que la session est active\n    checkSession () {\n        axios.get(\"http://localhost:8888/API/Session/session.php\", {withCredentials: true})\n\n        .then(function(response){\n        console.log(response);\n        })\n\n        .catch((error) => {\n        if(error.response && error.response.status=== 404){\n            this.setState({noSession: true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\n            console.log(error);\n        }\n        });\n    }\n\n    //methode qui permet d'attribuer à \"firstName\" la valeur entrée au clavier par l'utilisateur\n    handleChangeFirstName = (event) => {\n        this.setState({\n            firstName: event.target.value\n        })\n    }\n\n    //methode qui permet d'attribuer à \"lastName\" la valeur entrée au clavier par l'utilisateur\n    handleChangeLastName = (event) => {\n        this.setState({\n            lastName: event.target.value\n        })\n    }\n\n    //methode qui permet d'envoyer les données au fichier PHP \"modifier_firstname.php\" afin d'enregistrer la nouvelle donnée, lorque l'utilisateur appuie sur le bouton \"modifier\" a cote du prenom\n    handleSubmitFirstName = (firstName) => e => {\n        let formData = new FormData();\n        formData.append(\"firstname\",firstName);\n        const url = \"http://localhost:8888/API/MonCompte/modifier_firstname.php\"\n        axios.post(url, formData, {withCredentials: true})\n        \n        //succes modification prénom\n        .then(function(response){\n          console.log(response.status, response)\n          alert('Modification du prénom enregistrée');\n        })\n    \n        //echec modification prénom\n        .catch((error)=>{\n          console.log(error)\n          if (error.response && error.response.status === 403){\n            console.log(error);\n            alert('Echec modification');\n          }\n        });\n    \n        setTimeout(() => {\n          this.setState({\n            error: '',\n          });\n        }, 2000);\n              \n        e.preventDefault();\n      }\n\n      //methode qui permet d'envoyer les données au fichier PHP \"modifier_lastname.php\" afin d'enregistrer la nouvelle donnée, lorque l'utilisateur appuie sur le bouton \"modifier\" a cote du nom\n      handleSubmitLastName = (lastName) => e => {\n        let formData = new FormData();\n        formData.append(\"lastname\",lastName);\n        const url = \"http://localhost:8888/API/MonCompte/modifier_lastname.php\"\n        axios.post(url, formData, {withCredentials: true})\n        \n        //succes modification nom\n        .then(function(response){\n          console.log(response.status, response)\n          alert('Modification du nom enregistrée');\n        })\n    \n        //echec modification nom\n        .catch((error)=>{\n          console.log(error)\n          if (error.response && error.response.status === 403){\n            console.log(error);\n            alert('Echec modification');\n          }\n        });\n    \n        setTimeout(() => {\n          this.setState({\n            error: '',\n          });\n        }, 2000);\n              \n        e.preventDefault();\n      }\n      \n\n      //methode qui permet de récuperer les linformations de l'utilisateur via le fichier \"mon_compte.php\"     \n    async componentDidMount() {\n        const url = \"http://localhost:8888/API/MonCompte/mon_compte.php\";\n        const response = await fetch(url,{credentials: 'include'});\n        const data = await response.json();\n        this.setState({\n            informations: data.results.profile[0], //\"informations\" contient les données reçues par le back-end \n            loading: false //booleen \"loading\" changé comme \"faux\"\n        })\n        console.log(data.results.profile);\n    }\n\n    render() {\n        const { firstName, lastName, informations } = this.state;\n        const {noSession} = this.state;\n\n        //appel à la methode qui verifie la session\n        this.checkSession ();\n\n        //s'il n'y a pas de session active, redirection vers la page de connexion\n        if(noSession){\n          return <Redirect to=\"/\"/>;\n        }\n\n        //si le temps de récupération des données a afficher est long\n        if(this.state.loading){\n            return <div>chargement...</div>;\n        }\n\n        //affichage des informations de l'utilisateur\n        //affichage des champs a remplir si l'utilisateur veut modifier ses donnees\n        //affichage des boutons \"modifier\"\n        return(\n            <div>\n                <h1 className = \"titleMyAccount\">Mes informations personnelles</h1>\n                <MDBTable hover bordered maxHeight=\"350px\">\n                    <MDBTableBody>  \n                        <tr>\n                            <td>Adresse email : {informations.email}</td>\n                        </tr>\n                        <tr>\n                            <td>Prénom : \n                              <br></br>\n                                <input className=\"inputModif\" value={firstName} defaultValue={informations.firstname} onChange={e => this.handleChangeFirstName(e)}/>          \n                            <MDBBtn color=\"dark\" onClick={this.handleSubmitFirstName(this.state.firstName)}>Modifier</MDBBtn>\n                            </td>   \n                        </tr>\n                        <tr>\n                            <td>Nom : \n                              <br></br>\n                                <input className=\"inputModif\" value={lastName} defaultValue={informations.lastname} onChange={e => this.handleChangeLastName(e)}/>         \n                            <MDBBtn color=\"dark\" onClick={this.handleSubmitLastName(this.state.lastName)}>Modifier</MDBBtn></td>\n                        </tr>\n                    </MDBTableBody>\n            </MDBTable>\n            </div>\n        )\n    }   \n}\n\nexport default MyAccount;"]},"metadata":{},"sourceType":"module"}