{"ast":null,"code":"import _regeneratorRuntime from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _asyncToGenerator from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/inherits\";/* eslint-disable react/button-has-type */ /* eslint-disable jsx-a11y/label-has-associated-control */import React from'react';import{Redirect}from'react-router';import'./formulaireAchat.css';import{MDBContainer,MDBRow,MDBCard,MDBCardBody}from'mdbreact';import axios from'axios';var NextPurchase=/*#__PURE__*/function(_React$Component){_inherits(NextPurchase,_React$Component);function NextPurchase(props){var _this;_classCallCheck(this,NextPurchase);_this=_possibleConstructorReturn(this,_getPrototypeOf(NextPurchase).call(this,props));_this.change=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _this.setState(_defineProperty({},e.target.id,e.target.value));case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handleSubmitPurchase=function(e){var _this$state=_this.state,title=_this$state.title,author=_this$state.author;//cas ou tous les champs sont remplis\nif(title&&author){console.log(_this.state);var formData=new FormData();formData.append(\"title\",_this.state.title);formData.append(\"author\",_this.state.author);var url=\"http://localhost:8888/API/AjouterAchat/ajout_prochain_achat.php\";axios.post(url,formData,{withCredentials:true})//succes enregistrer prochain achat\n.then(function(response){this.setState({registeredPurchase:true});console.log(response);alert('Livre enregistré dans vos prochains achats');}.bind(_assertThisInitialized(_this)))//echec enregistrer prochain achat\n.catch(function(error){if(error.response&&error.response.status===403){console.log(error);alert('Erreur: Ce livre existe déjà dans votre bibliothèque !');}});}else{//cas ou les champs ne sont pas remplis\n_this.setState({error:'Veuillez saisir tous les champs !'});}setTimeout(function(){_this.setState({error:''});},2000);e.preventDefault();};_this.state={noSession:false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\ntitle:null,//va contenir la valeur entrée pour le champs \"titre\" du formulaire\nauthor:null,//va contenir la valeur entrée pour le champs \"auteur\" du formulaire\nregisteredPurchase:false,//initialise le statut de redirection comme faux\nerror:''//va contenir l'erreur en cas d'erreur\n};_this.checkSession=_this.checkSession.bind(_assertThisInitialized(_this));return _this;}//Vérifie que la session est active\n_createClass(NextPurchase,[{key:\"checkSession\",value:function checkSession(){var _this2=this;axios.get(\"http://localhost:8888/API/Session/session.php\",{withCredentials:true}).then(function(response){console.log(response);}).catch(function(error){if(error.response&&error.response.status===404){_this2.setState({noSession:true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\nconsole.log(error);}});}//methode qui permet d'attribuer à \"title\" et \"author\" les valeurs entrées au clavier par l'utilisateur\n},{key:\"render\",value:function render(){var error=this.state.error;var container={height:800};var registeredPurchase=this.state.registeredPurchase;var noSession=this.state.noSession;//appel à la methode qui verifie la session\nthis.checkSession();//s'il n'y a pas de session active, redirection vers la page de connexion\nif(noSession){return React.createElement(Redirect,{to:\"/\"});}//redirection vers la page des prochains achats si le prochain achat a été enregistré correctement\nif(registeredPurchase){return React.createElement(Redirect,{to:\"/prochainAchat\"});}//affichage du formulaire de prochaina achat a completer par l'utilisateur\n//affichage du bouton \"valider\" en fin de formulaire\nreturn React.createElement(MDBContainer,{style:container,className:\"containerAchat\"},React.createElement(MDBRow,null,React.createElement(\"div\",{className:\"colAchat\"},React.createElement(MDBCard,null,React.createElement(MDBCardBody,null,React.createElement(\"form\",{onSubmit:this.handleSubmitPurchase,className:\"form\"},React.createElement(\"div\",{className:\"text-center\"},React.createElement(\"h2\",{className:\"dark-grey-text mb-5\"},\"Ajouter un prochain achat\")),React.createElement(\"div\",{className:\"grey-text\"},React.createElement(\"label\",{htmlFor:\"title\",className:\"grey-text\"},\"Titre\"),React.createElement(\"input\",{type:\"text\",id:\"title\",placeholder:\"Titre\",className:\"form-control\",onChange:this.change,required:true}),React.createElement(\"br\",null),React.createElement(\"label\",{htmlFor:\"author\",className:\"grey-text\"},\"Auteur\"),React.createElement(\"input\",{type:\"text\",id:\"author\",placeholder:\"Auteur\",className:\"form-control\",onChange:this.change,required:true})),React.createElement(\"div\",{className:\"text-center py-4 mt-3\"},React.createElement(\"button\",{className:\"btn btn-primary\",onClick:this.handleSubmitPurchase,type:\"submit\"},\"Valider\"),error&&React.createElement(\"p\",{className:\"error\"},error))))))));}}]);return NextPurchase;}(React.Component);export default NextPurchase;","map":{"version":3,"sources":["/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/src/components/ProchainAchat/formulaireAchat.js"],"names":["React","Redirect","MDBContainer","MDBRow","MDBCard","MDBCardBody","axios","NextPurchase","props","change","e","setState","target","id","value","handleSubmitPurchase","state","title","author","console","log","formData","FormData","append","url","post","withCredentials","then","response","registeredPurchase","alert","bind","catch","error","status","setTimeout","preventDefault","noSession","checkSession","get","container","height","Component"],"mappings":"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","sourcesContent":["/* eslint-disable react/button-has-type */\n/* eslint-disable jsx-a11y/label-has-associated-control */\nimport React from 'react';\nimport { Redirect} from 'react-router';\nimport './formulaireAchat.css';\nimport {\n  MDBContainer, MDBRow, MDBCard, MDBCardBody,\n} from 'mdbreact';\nimport axios from 'axios';\n\nclass NextPurchase extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      noSession: false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\n      title: null,//va contenir la valeur entrée pour le champs \"titre\" du formulaire\n      author: null,//va contenir la valeur entrée pour le champs \"auteur\" du formulaire\n      registeredPurchase: false,//initialise le statut de redirection comme faux\n      error: '',//va contenir l'erreur en cas d'erreur\n\n    }\n    this.checkSession = this.checkSession.bind(this);\n  }\n\n  //Vérifie que la session est active\n  checkSession () {\n    axios.get(\"http://localhost:8888/API/Session/session.php\", {withCredentials: true})\n\n    .then(function(response){\n      console.log(response);\n    })\n\n    .catch((error) => {\n      if(error.response && error.response.status=== 404){\n        this.setState({noSession: true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\n        console.log(error);\n      }\n    });\n  }\n\n  //methode qui permet d'attribuer à \"title\" et \"author\" les valeurs entrées au clavier par l'utilisateur\n  change = async e => {\n    await this.setState({\n      [e.target.id]: e.target.value,\n    });\n  }\n\n  //methode qui permet d'envoyer les données au fichier PHP \"ajout_prochain_achat.php\" afin d'enregistrer le nouvel achat, lorque l'utilisateur appuie sur le bouton \"valider\"\n  handleSubmitPurchase = e => {\n\n    const {\n      title, author,\n    } = this.state;\n\n    //cas ou tous les champs sont remplis\n    if (title && author) {\n\n        \n        console.log(this.state);\n        let formData = new FormData();\n        formData.append(\"title\",this.state.title);\n        formData.append(\"author\",this.state.author);\n        const url = \"http://localhost:8888/API/AjouterAchat/ajout_prochain_achat.php\";\n        axios.post(url,formData, {withCredentials: true})\n\n        //succes enregistrer prochain achat\n        .then(function(response){\n          this.setState({registeredPurchase:true});\n          console.log(response);\n          alert('Livre enregistré dans vos prochains achats');\n        }.bind(this))\n\n        //echec enregistrer prochain achat\n        .catch((error) => {\n          if (error.response && error.response.status === 403){\n            console.log(error);\n            alert('Erreur: Ce livre existe déjà dans votre bibliothèque !');\n          }\n        }); \n\n        \n    } else {\n      //cas ou les champs ne sont pas remplis\n      this.setState({\n        error: 'Veuillez saisir tous les champs !',\n      });\n    }\n    setTimeout(() => {\n      this.setState({\n        error: '',\n      });\n    }, 2000);\n          \n    e.preventDefault();\n  }\n\n  render() {\n    const { error } = this.state;\n    const container = {height: 800};\n    const {registeredPurchase} = this.state;\n    const {noSession} = this.state;\n\n    //appel à la methode qui verifie la session\n    this.checkSession ();\n\n    //s'il n'y a pas de session active, redirection vers la page de connexion\n    if(noSession){\n      return <Redirect to=\"/\"/>;\n    }\n    \n    //redirection vers la page des prochains achats si le prochain achat a été enregistré correctement\n    if(registeredPurchase){\n      return <Redirect to=\"/prochainAchat\"/>;\n    }\n\n    //affichage du formulaire de prochaina achat a completer par l'utilisateur\n    //affichage du bouton \"valider\" en fin de formulaire\n    return (\n      <MDBContainer style={container} className=\"containerAchat\">\n        <MDBRow>\n          <div className=\"colAchat\">\n            <MDBCard>\n              <MDBCardBody>\n                <form onSubmit={this.handleSubmitPurchase} className=\"form\">\n                  <div className=\"text-center\">\n                    <h2 className=\"dark-grey-text mb-5\">\n                      Ajouter un prochain achat\n                    </h2>\n                  </div>\n                  <div className=\"grey-text\">\n                    <label htmlFor=\"title\" className=\"grey-text\">\n                      Titre\n                    </label>\n                    <input\n                      type=\"text\"\n                      id=\"title\"\n                      placeholder=\"Titre\"\n                      className=\"form-control\"\n                      onChange={this.change}\n                      required\n                    />\n\n                    <br />\n\n                    <label htmlFor=\"author\" className=\"grey-text\">\n                      Auteur\n                    </label>\n                    <input\n                      type=\"text\"\n                      id=\"author\"\n                      placeholder=\"Auteur\"\n                      className=\"form-control\"\n                      onChange={this.change}\n                      required\n                    />\n\n                  </div>\n                  <div className=\"text-center py-4 mt-3\">\n                    <button className=\"btn btn-primary\" onClick={this.handleSubmitPurchase} type=\"submit\">Valider</button>\n                    {\n                     error && (\n                     <p className=\"error\">{error}</p>\n                     )\n                    }\n                  </div>\n\n                </form>\n\n              </MDBCardBody>\n            </MDBCard>\n          </div>\n        </MDBRow>\n      </MDBContainer>\n\n    );\n  }\n}\n\nexport default NextPurchase;\n"]},"metadata":{},"sourceType":"module"}