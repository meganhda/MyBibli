{"ast":null,"code":"var _jsxFileName = \"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/src/components/ProchainAchat/formulaireAchat.js\";\n\n/* eslint-disable react/button-has-type */\n\n/* eslint-disable jsx-a11y/label-has-associated-control */\nimport React from 'react';\nimport { Redirect } from 'react-router';\nimport './formulaireAchat.css';\nimport { MDBContainer, MDBRow, MDBCard, MDBCardBody } from 'mdbreact';\nimport axios from 'axios';\n\nclass NextPurchase extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.change = async e => {\n      await this.setState({\n        [e.target.id]: e.target.value\n      });\n    };\n\n    this.handleSubmitPurchase = e => {\n      const {\n        title,\n        author\n      } = this.state; //cas ou tous les champs sont remplis\n\n      if (title && author) {\n        console.log(this.state);\n        let formData = new FormData();\n        formData.append(\"title\", this.state.title);\n        formData.append(\"author\", this.state.author);\n        const url = \"http://localhost:8888/API/AjouterAchat/ajout_prochain_achat.php\";\n        axios.post(url, formData, {\n          withCredentials: true\n        }) //succes enregistrer prochain achat\n        .then(function (response) {\n          this.setState({\n            registeredPurchase: true\n          });\n          console.log(response);\n          alert('Livre enregistré dans vos prochains achats');\n        }.bind(this)) //echec enregistrer prochain achat\n        .catch(error => {\n          if (error.response && error.response.status === 403) {\n            console.log(error);\n            alert('Erreur: Ce livre existe déjà dans votre bibliothèque !');\n          }\n        });\n      } else {\n        //cas ou les champs ne sont pas remplis\n        this.setState({\n          error: 'Veuillez saisir tous les champs !'\n        });\n      }\n\n      setTimeout(() => {\n        this.setState({\n          error: ''\n        });\n      }, 2000);\n      e.preventDefault();\n    };\n\n    this.state = {\n      noSession: false,\n      //booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\n      title: null,\n      //va contenir la valeur entrée pour le champs \"titre\" du formulaire\n      author: null,\n      //va contenir la valeur entrée pour le champs \"auteur\" du formulaire\n      registeredPurchase: false,\n      //initialise le statut de redirection comme faux\n      error: '' //va contenir l'erreur en cas d'erreur\n\n    };\n    this.checkSession = this.checkSession.bind(this);\n  } //Vérifie que la session est active\n\n\n  checkSession() {\n    axios.get(\"http://localhost:8888/API/Session/session.php\", {\n      withCredentials: true\n    }).then(function (response) {\n      console.log(response);\n    }).catch(error => {\n      if (error.response && error.response.status === 404) {\n        this.setState({\n          noSession: true\n        }); //s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\n\n        console.log(error);\n      }\n    });\n  } //methode qui permet d'attribuer à \"title\" et \"author\" les valeurs entrées au clavier par l'utilisateur\n\n\n  render() {\n    const {\n      error\n    } = this.state;\n    const container = {\n      height: 800\n    };\n    const {\n      registeredPurchase\n    } = this.state;\n    const {\n      noSession\n    } = this.state; //appel à la methode qui verifie la session\n\n    this.checkSession(); //s'il n'y a pas de session active, redirection vers la page de connexion\n\n    if (noSession) {\n      return React.createElement(Redirect, {\n        to: \"/\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 108\n        },\n        __self: this\n      });\n    } //redirection vers la page des prochains achats si le prochain achat a été enregistré correctement\n\n\n    if (registeredPurchase) {\n      return React.createElement(Redirect, {\n        to: \"/prochainAchat\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      });\n    } //affichage du formulaire de prochaina achat a completer par l'utilisateur\n    //affichage du bouton \"valider\" en fin de formulaire\n\n\n    return React.createElement(MDBContainer, {\n      style: container,\n      className: \"containerAchat\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119\n      },\n      __self: this\n    }, React.createElement(MDBRow, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"colAchat\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121\n      },\n      __self: this\n    }, React.createElement(MDBCard, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    }, React.createElement(MDBCardBody, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      onSubmit: this.handleSubmitPurchase,\n      className: \"form\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"text-center\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, React.createElement(\"h2\", {\n      className: \"dark-grey-text mb-5\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, \"Ajouter un prochain achat\")), React.createElement(\"div\", {\n      className: \"grey-text\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      htmlFor: \"title\",\n      className: \"grey-text\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }, \"Titre\"), React.createElement(\"input\", {\n      type: \"text\",\n      id: \"title\",\n      placeholder: \"Titre\",\n      className: \"form-control\",\n      onChange: this.change,\n      required: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143\n      },\n      __self: this\n    }), React.createElement(\"label\", {\n      htmlFor: \"author\",\n      className: \"grey-text\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145\n      },\n      __self: this\n    }, \"Auteur\"), React.createElement(\"input\", {\n      type: \"text\",\n      id: \"author\",\n      placeholder: \"Auteur\",\n      className: \"form-control\",\n      onChange: this.change,\n      required: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"text-center py-4 mt-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      className: \"btn btn-primary\",\n      onClick: this.handleSubmitPurchase,\n      type: \"submit\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159\n      },\n      __self: this\n    }, \"Valider\"), error && React.createElement(\"p\", {\n      className: \"error\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162\n      },\n      __self: this\n    }, error))))))));\n  }\n\n}\n\nexport default NextPurchase;","map":{"version":3,"sources":["/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/src/components/ProchainAchat/formulaireAchat.js"],"names":["React","Redirect","MDBContainer","MDBRow","MDBCard","MDBCardBody","axios","NextPurchase","Component","constructor","props","change","e","setState","target","id","value","handleSubmitPurchase","title","author","state","console","log","formData","FormData","append","url","post","withCredentials","then","response","registeredPurchase","alert","bind","catch","error","status","setTimeout","preventDefault","noSession","checkSession","get","render","container","height"],"mappings":"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","sourcesContent":["/* eslint-disable react/button-has-type */\n/* eslint-disable jsx-a11y/label-has-associated-control */\nimport React from 'react';\nimport { Redirect} from 'react-router';\nimport './formulaireAchat.css';\nimport {\n  MDBContainer, MDBRow, MDBCard, MDBCardBody,\n} from 'mdbreact';\nimport axios from 'axios';\n\nclass NextPurchase extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      noSession: false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\n      title: null,//va contenir la valeur entrée pour le champs \"titre\" du formulaire\n      author: null,//va contenir la valeur entrée pour le champs \"auteur\" du formulaire\n      registeredPurchase: false,//initialise le statut de redirection comme faux\n      error: '',//va contenir l'erreur en cas d'erreur\n\n    }\n    this.checkSession = this.checkSession.bind(this);\n  }\n\n  //Vérifie que la session est active\n  checkSession () {\n    axios.get(\"http://localhost:8888/API/Session/session.php\", {withCredentials: true})\n\n    .then(function(response){\n      console.log(response);\n    })\n\n    .catch((error) => {\n      if(error.response && error.response.status=== 404){\n        this.setState({noSession: true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\n        console.log(error);\n      }\n    });\n  }\n\n  //methode qui permet d'attribuer à \"title\" et \"author\" les valeurs entrées au clavier par l'utilisateur\n  change = async e => {\n    await this.setState({\n      [e.target.id]: e.target.value,\n    });\n  }\n\n  //methode qui permet d'envoyer les données au fichier PHP \"ajout_prochain_achat.php\" afin d'enregistrer le nouvel achat, lorque l'utilisateur appuie sur le bouton \"valider\"\n  handleSubmitPurchase = e => {\n\n    const {\n      title, author,\n    } = this.state;\n\n    //cas ou tous les champs sont remplis\n    if (title && author) {\n\n        \n        console.log(this.state);\n        let formData = new FormData();\n        formData.append(\"title\",this.state.title);\n        formData.append(\"author\",this.state.author);\n        const url = \"http://localhost:8888/API/AjouterAchat/ajout_prochain_achat.php\";\n        axios.post(url,formData, {withCredentials: true})\n\n        //succes enregistrer prochain achat\n        .then(function(response){\n          this.setState({registeredPurchase:true});\n          console.log(response);\n          alert('Livre enregistré dans vos prochains achats');\n        }.bind(this))\n\n        //echec enregistrer prochain achat\n        .catch((error) => {\n          if (error.response && error.response.status === 403){\n            console.log(error);\n            alert('Erreur: Ce livre existe déjà dans votre bibliothèque !');\n          }\n        }); \n\n        \n    } else {\n      //cas ou les champs ne sont pas remplis\n      this.setState({\n        error: 'Veuillez saisir tous les champs !',\n      });\n    }\n    setTimeout(() => {\n      this.setState({\n        error: '',\n      });\n    }, 2000);\n          \n    e.preventDefault();\n  }\n\n  render() {\n    const { error } = this.state;\n    const container = {height: 800};\n    const {registeredPurchase} = this.state;\n    const {noSession} = this.state;\n\n    //appel à la methode qui verifie la session\n    this.checkSession ();\n\n    //s'il n'y a pas de session active, redirection vers la page de connexion\n    if(noSession){\n      return <Redirect to=\"/\"/>;\n    }\n    \n    //redirection vers la page des prochains achats si le prochain achat a été enregistré correctement\n    if(registeredPurchase){\n      return <Redirect to=\"/prochainAchat\"/>;\n    }\n\n    //affichage du formulaire de prochaina achat a completer par l'utilisateur\n    //affichage du bouton \"valider\" en fin de formulaire\n    return (\n      <MDBContainer style={container} className=\"containerAchat\">\n        <MDBRow>\n          <div className=\"colAchat\">\n            <MDBCard>\n              <MDBCardBody>\n                <form onSubmit={this.handleSubmitPurchase} className=\"form\">\n                  <div className=\"text-center\">\n                    <h2 className=\"dark-grey-text mb-5\">\n                      Ajouter un prochain achat\n                    </h2>\n                  </div>\n                  <div className=\"grey-text\">\n                    <label htmlFor=\"title\" className=\"grey-text\">\n                      Titre\n                    </label>\n                    <input\n                      type=\"text\"\n                      id=\"title\"\n                      placeholder=\"Titre\"\n                      className=\"form-control\"\n                      onChange={this.change}\n                      required\n                    />\n\n                    <br />\n\n                    <label htmlFor=\"author\" className=\"grey-text\">\n                      Auteur\n                    </label>\n                    <input\n                      type=\"text\"\n                      id=\"author\"\n                      placeholder=\"Auteur\"\n                      className=\"form-control\"\n                      onChange={this.change}\n                      required\n                    />\n\n                  </div>\n                  <div className=\"text-center py-4 mt-3\">\n                    <button className=\"btn btn-primary\" onClick={this.handleSubmitPurchase} type=\"submit\">Valider</button>\n                    {\n                     error && (\n                     <p className=\"error\">{error}</p>\n                     )\n                    }\n                  </div>\n\n                </form>\n\n              </MDBCardBody>\n            </MDBCard>\n          </div>\n        </MDBRow>\n      </MDBContainer>\n\n    );\n  }\n}\n\nexport default NextPurchase;\n"]},"metadata":{},"sourceType":"module"}