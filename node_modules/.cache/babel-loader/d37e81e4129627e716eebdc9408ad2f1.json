{"ast":null,"code":"import _regeneratorRuntime from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Fragment}from\"react\";import{MDBBtn,MDBTableBody,MDBTableHead,MDBTable,MDBModal,MDBModalHeader,MDBModalBody,MDBModalFooter}from\"mdbreact\";import'./mesProchainsAchats.css';import axios from'axios';import{Redirect}from'react-router';var NextPurchasePage=/*#__PURE__*/function(_React$Component){_inherits(NextPurchasePage,_React$Component);function NextPurchasePage(props){var _this;_classCallCheck(this,NextPurchasePage);_this=_possibleConstructorReturn(this,_getPrototypeOf(NextPurchasePage).call(this,props));_this.openModalBuy=function(id){return function(e){_this.setState({modal:true,idPurchase:id});};};_this.closeModalBuy=function(){_this.setState({modal:false});};_this.change=function(e){_this.setState(_defineProperty({},e.target.name,e.target.value));};_this.buyBook=function(year,date,edition,typeBook){return function(e){var _this$state=_this.state,idPurchase=_this$state.idPurchase,purchases=_this$state.purchases;var newBooks=purchases;console.log(idPurchase,'idPurchaseSubmit');_this.setState({modal:false});var formData=new FormData();formData.append(\"id\",idPurchase);formData.append(\"year\",year);formData.append(\"date\",date);formData.append(\"edition\",edition);formData.append(\"typeBook\",typeBook);var url=\"http://localhost:8888/API/MesProchainsAchats/transfert_prochain_achat.php\";axios.post(url,formData,{withCredentials:true})//succes achat livre\n.then(function(response){console.log(response.status,response);alert('Livre transféré dans votre bibliothèque');var tmp=purchases;newBooks=tmp.filter(function(livre){return livre.id!==idPurchase;});})//echec achat livre\n.catch(function(error){console.log(error);if(error.response&&error.response.status===403){console.log(error);alert(error.response.data);}});setTimeout(function(){_this.setState({purchases:newBooks});},500);setTimeout(function(){_this.setState({error:''});},2000);e.preventDefault();};};_this.handleDelete=function(id){return function(e){var purchases=_this.state.purchases;var newBooks=purchases;var formData=new FormData();formData.append(\"id\",id);var url=\"http://localhost:8888/API/MesLivres/supprimer_livre.php\";axios.post(url,formData,{withCredentials:true}).then(function(response){var tmp=purchases;newBooks=tmp.filter(function(livre){return livre.id!==id;});alert('Livre supprimé de vos prochains achats');}).catch(function(error){console.log(error);if(error.response.status===403){console.log(error);alert('Echec de la suppression');}});setTimeout(function(){_this.setState({purchases:newBooks});},500);setTimeout(function(){_this.setState({error:''});},2000);e.preventDefault();};};_this.state={noSession:false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\nloading:true,//booleen initialisé comme vrai, qui va changer lors de la récupération des données\npurchases:[],//va contenir les prochains achats de l'utilisateur\nyear:'',//va contenir la valeur entrée pour le champs \"année de sortie\" du formulaire de validation d'achat\ndate:'',//va contenir la valeur entrée pour le champs \"date d'achat\" du formulaire de validation d'achat\nedition:'',//va contenir la valeur entrée pour le champs \"edition\" du formulaire de validation d'achat\ntypeBook:'',//va contenir la valeur entrée pour le champs \"type\" du formulaire de validation d'achat\nmodal:false,//booleen qui va permettre d'ouvrir/fermer une fenetre lorsque l'utilisateur appuie sur \"acheté\"\nid:'',//va contenir l'id du livre selectionné par l'utilisateur lorsqu'il appuiera sur les boutons \"acheté/supprimer\"\nerror:'',//va contenir l'erreur en cas d'erreur\nidPurchase:null//va contenir l'id du livre acheté\n};_this.checkSession=_this.checkSession.bind(_assertThisInitialized(_this));_this.handleDelete=_this.handleDelete.bind(_assertThisInitialized(_this));_this.buyBook=_this.buyBook.bind(_assertThisInitialized(_this));_this.openModalBuy=_this.openModalBuy.bind(_assertThisInitialized(_this));return _this;}//Vérifie que la session est active\n_createClass(NextPurchasePage,[{key:\"checkSession\",value:function checkSession(){var _this2=this;axios.get(\"http://localhost:8888/API/Session/session.php\",{withCredentials:true}).then(function(response){console.log(response);}).catch(function(error){if(error.response&&error.response.status===404){_this2.setState({noSession:true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\nconsole.log(error);}});}//methode qui permet d'ouvrir une fenetre contenant un formulaire a completer par l'utilisateur, lorsque celui-ci appuie sur \"acheté\"\n},{key:\"componentDidMount\",//methode qui permet de récuperer les prochains achats de l'utilisateur via le fichier \"liste_achat.php\"\nvalue:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var url,response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:url=\"http://localhost:8888/API/MesProchainsAchats/liste_achat.php\";_context.next=3;return fetch(url,{credentials:'include'});case 3:response=_context.sent;_context.next=6;return response.json();case 6:data=_context.sent;this.setState({purchases:data.results.livres,loading:false});//\"purchases\" contient les données reçues par le back-end \nconsole.log(data.results.livres);case 9:case\"end\":return _context.stop();}}},_callee,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this3=this;var noSession=this.state.noSession;//appel à la methode qui verifie la session\nthis.checkSession();//s'il n'y a pas de session active, redirection vers la page de connexion\nif(noSession){return React.createElement(Redirect,{to:\"/\"});}//si le temps de récupération des données a afficher est long\nif(this.state.loading){return React.createElement(\"div\",null,\"chargement...\");}//si l'utilisateur n'a pas de prochains achats prevus\n//affichage du bouton qui redirige vers le formulaire de prochain achat\nif(this.state.purchases.length===0){return React.createElement(\"div\",null,React.createElement(\"h1\",{className:\"titleMyPurchases\"},\" Mes prochains achats \"),React.createElement(\"div\",{className:\"noPurchase\"},\"Vous n'avez actuellement aucun achat pr\\xE9vu.\"),React.createElement(\"div\",{className:\"buttonAchat\"},React.createElement(Fragment,null,React.createElement(MDBBtn,{href:\"/formulaireProchainAchat\",color:\"dark\"},\"Ajouter un prochain achat\"))));}//sinon:\n//affichage d'un tableau avec les prochains achats de l'utilisateur, grâce a la fonction map qui va parcourir \"purchases\"\n//affichage des boutons \"supprimer\" et \"acheté\" sur chaque ligne du tableau\n//ouverture d'une fenetre avec le formulaire d'achat\n//affichage du bouton qui redirige vers le formulaire de prochain achat\nreturn React.createElement(\"div\",null,React.createElement(\"h1\",{className:\"titleMyPurchases\"},\" Mes prochains achats \"),React.createElement(\"h2\",null,\" Vous avez \",this.state.purchases.length,\" prochain(s) achat(s) programm\\xE9(s):\"),React.createElement(\"br\",null),React.createElement(MDBTable,{hover:true,bordered:true,scrollY:true,maxHeight:\"350px\"},React.createElement(MDBTableHead,null,React.createElement(\"tr\",null,React.createElement(\"th\",null,\"Titre\"),React.createElement(\"th\",null,\"Auteur\"),React.createElement(\"th\",null),React.createElement(\"th\",null))),React.createElement(MDBTableBody,null,this.state.purchases.map(function(livre){return React.createElement(\"tr\",{key:livre.id,onChange:_this3.Change},React.createElement(\"td\",null,livre.title),React.createElement(\"td\",null,livre.author),React.createElement(\"td\",null,React.createElement(MDBBtn,{onClick:_this3.openModalBuy(livre.id),color:\"dark\"},\"Achet\\xE9\"),React.createElement(MDBModal,{isOpen:_this3.state.modal},React.createElement(MDBModalHeader,null,\"Informations compl\\xE8mentaires\"),React.createElement(MDBModalBody,null,React.createElement(\"label\",{htmlFor:\"year\",className:\"grey-text\"},\"Ann\\xE9e de sortie\"),React.createElement(\"input\",{type:\"number\",name:\"year\",value:_this3.state.year,className:\"form-control\",placeholder:\"Ann\\xE9e\",onChange:function onChange(e){return _this3.change(e);}}),React.createElement(\"br\",null),React.createElement(\"label\",{htmlFor:\"date\",className:\"grey-text\"},\"Date d'achat\"),React.createElement(\"input\",{type:\"date\",name:\"date\",value:_this3.state.date,placeholder:\"jj/mm/aa\",className:\"form-control\",onChange:function onChange(e){return _this3.change(e);}}),React.createElement(\"br\",null),React.createElement(\"label\",{htmlFor:\"edition\",className:\"grey-text\"},\"Edition\"),React.createElement(\"input\",{type:\"text\",name:\"edition\",value:_this3.state.edition,placeholder:\"Edition\",className:\"form-control\",onChange:function onChange(e){return _this3.change(e);}}),React.createElement(\"br\",null),React.createElement(\"label\",{htmlFor:\"typeBook\",className:\"grey-text\"},\"Type\"),React.createElement(\"input\",{type:\"text\",name:\"typeBook\",value:_this3.state.typeBook,placeholder:\"Type\",className:\"form-control\",onChange:function onChange(e){return _this3.change(e);}})),React.createElement(MDBModalFooter,null,React.createElement(MDBBtn,{color:\"danger\",onClick:_this3.closeModalBuy},\"Annuler\"),React.createElement(MDBBtn,{onClick:_this3.buyBook(_this3.state.year,_this3.state.date,_this3.state.edition,_this3.state.typeBook),color:\"dark\"},\"Valider l'achat\")))),React.createElement(\"td\",null,React.createElement(MDBBtn,{onClick:_this3.handleDelete(livre.id),color:\"danger\"},\"Supprimer\")));}))),React.createElement(\"div\",{className:\"buttonAchat\"},React.createElement(Fragment,null,React.createElement(MDBBtn,{href:\"/formulaireProchainAchat\",color:\"dark\"},\"Ajouter un prochain achat\"))));}}]);return NextPurchasePage;}(React.Component);export default NextPurchasePage;","map":{"version":3,"sources":["/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/src/components/MesProchainsAchats/mesProchainsAchats.js"],"names":["React","Fragment","MDBBtn","MDBTableBody","MDBTableHead","MDBTable","MDBModal","MDBModalHeader","MDBModalBody","MDBModalFooter","axios","Redirect","NextPurchasePage","props","openModalBuy","id","e","setState","modal","idPurchase","closeModalBuy","change","target","name","value","buyBook","year","date","edition","typeBook","state","purchases","newBooks","console","log","formData","FormData","append","url","post","withCredentials","then","response","status","alert","tmp","filter","livre","catch","error","data","setTimeout","preventDefault","handleDelete","noSession","loading","checkSession","bind","get","fetch","credentials","json","results","livres","length","map","Change","title","author","Component"],"mappings":"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","sourcesContent":["import React, { Fragment } from \"react\";\nimport { MDBBtn, MDBTableBody, MDBTableHead, MDBTable, MDBModal, MDBModalHeader, MDBModalBody,MDBModalFooter,} from \"mdbreact\";\nimport './mesProchainsAchats.css';\nimport axios from 'axios';\nimport { Redirect} from 'react-router';\n\n\nclass NextPurchasePage extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      noSession: false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\n      loading: true,//booleen initialisé comme vrai, qui va changer lors de la récupération des données\n      purchases: [],//va contenir les prochains achats de l'utilisateur\n      year: '',//va contenir la valeur entrée pour le champs \"année de sortie\" du formulaire de validation d'achat\n      date: '',//va contenir la valeur entrée pour le champs \"date d'achat\" du formulaire de validation d'achat\n      edition: '',//va contenir la valeur entrée pour le champs \"edition\" du formulaire de validation d'achat\n      typeBook: '',//va contenir la valeur entrée pour le champs \"type\" du formulaire de validation d'achat\n      modal: false,//booleen qui va permettre d'ouvrir/fermer une fenetre lorsque l'utilisateur appuie sur \"acheté\"\n      id: '',//va contenir l'id du livre selectionné par l'utilisateur lorsqu'il appuiera sur les boutons \"acheté/supprimer\"\n      error: '',//va contenir l'erreur en cas d'erreur\n      idPurchase: null,//va contenir l'id du livre acheté\n    }\n    this.checkSession = this.checkSession.bind(this);\n    this.handleDelete = this.handleDelete.bind(this);\n    this.buyBook = this.buyBook.bind(this);\n    this.openModalBuy = this.openModalBuy.bind(this);\n  }\n\n  //Vérifie que la session est active\n  checkSession () {\n    axios.get(\"http://localhost:8888/API/Session/session.php\", {withCredentials: true})\n\n    .then(function(response){\n      console.log(response);\n    })\n\n    .catch((error) => {\n      if(error.response && error.response.status=== 404){\n        this.setState({noSession: true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\n        console.log(error);\n      }\n    });\n  }\n\n  //methode qui permet d'ouvrir une fenetre contenant un formulaire a completer par l'utilisateur, lorsque celui-ci appuie sur \"acheté\"\n  openModalBuy = (id) => e => {\n    this.setState({\n      modal: true,\n      idPurchase: id\n    });\n  }\n\n  //methode qui permet de fermer la fenetre d'achat, lorsque l'utilisateur appuie sur \"annuler\"\n  closeModalBuy = () => {\n  this.setState({\n    modal: false,\n    });\n  }\n\n  //methode qui permet d'attribuer à \"year\", \"date\", \"edition\" et \"typeBook\" les nouvelles valeurs entrées au clavier par l'utilisateur lors de l'achat d'un livre\n  change = e => {\n    this.setState ({\n      [e.target.name]: e.target.value\n    });\n  };\n\n  //methode qui permet d'envoyer les données au fichier PHP \"transfert_prochain_achat.php\" afin d'enregistrer les donnees d'un livre, lorque l'utilisateur appuie sur le bouton \"enregistrer\" de la fenetre d'achat\n  buyBook = (year, date, edition, typeBook) => e => {\n    const { idPurchase, purchases } = this.state;\n    let newBooks = purchases;\n    console.log(idPurchase,'idPurchaseSubmit');\n    this.setState({\n      modal: false,\n    })\n    let formData = new FormData();\n    formData.append(\"id\",idPurchase);\n    formData.append(\"year\",year);\n    formData.append(\"date\",date);\n    formData.append(\"edition\",edition);\n    formData.append(\"typeBook\",typeBook);\n    const url = \"http://localhost:8888/API/MesProchainsAchats/transfert_prochain_achat.php\"\n    axios.post(url, formData, {withCredentials: true})\n    \n    //succes achat livre\n    .then(function(response){\n      console.log(response.status, response)\n      alert('Livre transféré dans votre bibliothèque');\n      const tmp = purchases;\n      newBooks = tmp.filter(livre => livre.id !== idPurchase);\n    })\n\n  //echec achat livre\n  .catch((error)=>{\n    console.log(error)\n    if (error.response && error.response.status === 403){\n      console.log(error);\n      alert(error.response.data);\n    }\n  });\n\n  setTimeout(() => {\n    this.setState({\n      purchases: newBooks\n    })\n  }, 500);\n  \n  setTimeout(() => {\n    this.setState({\n      error: '',\n    });\n  }, 2000);\n        \n  e.preventDefault();\n}\n\n//methode qui permet d'envoyer au fichier PHP \"supprimer_livre.php\" l'id du livre a supprimer, lorsque l'utilisateur appuie sur le bouton \"supprimer\"\nhandleDelete = (id) => e => {\n  const { purchases } = this.state;\n  let newBooks = purchases;\n  let formData = new FormData();\n  formData.append(\"id\",id);\n  const url = \"http://localhost:8888/API/MesLivres/supprimer_livre.php\"\n  axios.post(url, formData, {withCredentials: true})\n  \n  .then(function(response){\n    const tmp = purchases;\n    newBooks = tmp.filter(livre => livre.id !== id);\n    alert('Livre supprimé de vos prochains achats');\n  })\n\n  .catch((error)=>{\n    console.log(error)\n    if (error.response.status === 403){\n      console.log(error);\n      alert('Echec de la suppression');\n    }\n  });\n\n  setTimeout(() => {\n    this.setState({\n      purchases: newBooks\n    })\n  }, 500);\n  \n\n  setTimeout(() => {\n    this.setState({\n      error: '',\n    });\n  }, 2000);\n        \n  e.preventDefault();\n}\n\n\n//methode qui permet de récuperer les prochains achats de l'utilisateur via le fichier \"liste_achat.php\"\nasync componentDidMount() {\n    const url = \"http://localhost:8888/API/MesProchainsAchats/liste_achat.php\";\n    const response = await fetch(url,{credentials: 'include'});\n    const data = await response.json();\n    this.setState({purchases: data.results.livres, loading: false})//\"purchases\" contient les données reçues par le back-end \n    console.log(data.results.livres);\n  }\n\nrender() {\n    const {noSession} = this.state;\n      \n    //appel à la methode qui verifie la session\n    this.checkSession ();\n\n    //s'il n'y a pas de session active, redirection vers la page de connexion\n    if(noSession){\n      return <Redirect to=\"/\"/>;\n    }\n\n    //si le temps de récupération des données a afficher est long\n    if(this.state.loading){\n        return <div>chargement...</div>;\n    }\n\n    //si l'utilisateur n'a pas de prochains achats prevus\n    //affichage du bouton qui redirige vers le formulaire de prochain achat\n    if (this.state.purchases.length === 0){\n        return (\n          <div>\n            <h1 className=\"titleMyPurchases\"> Mes prochains achats </h1>\n            <div className=\"noPurchase\">\n              Vous n'avez actuellement aucun achat prévu.\n            </div>\n            <div className=\"buttonAchat\">\n                <Fragment>\n                    <MDBBtn href=\"/formulaireProchainAchat\" color=\"dark\"> \n                      Ajouter un prochain achat\n                    </MDBBtn>\n                </Fragment>\n            </div>\n          </div>  \n        );\n    } \n\n  //sinon:\n  //affichage d'un tableau avec les prochains achats de l'utilisateur, grâce a la fonction map qui va parcourir \"purchases\"\n  //affichage des boutons \"supprimer\" et \"acheté\" sur chaque ligne du tableau\n  //ouverture d'une fenetre avec le formulaire d'achat\n  //affichage du bouton qui redirige vers le formulaire de prochain achat\n    return (\n        <div>\n          <h1 className=\"titleMyPurchases\"> Mes prochains achats </h1>\n          <h2> Vous avez {this.state.purchases.length} prochain(s) achat(s) programmé(s):</h2>\n          <br></br>\n          <MDBTable hover bordered scrollY maxHeight=\"350px\">\n            <MDBTableHead>\n              <tr>\n              <th>Titre</th>\n              <th>Auteur</th>\n              <th></th>\n              <th></th>\n              </tr>\n            </MDBTableHead>\n            <MDBTableBody>\n              {\n                this.state.purchases.map(livre => (\n                  <tr key={livre.id} onChange={this.Change}>\n                    <td>{livre.title}</td>\n                    <td>{livre.author}</td>\n                    <td>\n                      <MDBBtn onClick={this.openModalBuy(livre.id)} color=\"dark\">Acheté</MDBBtn>\n                      <MDBModal isOpen={this.state.modal}>\n                        <MDBModalHeader>Informations complèmentaires</MDBModalHeader>\n                        <MDBModalBody>\n                            <label htmlFor=\"year\" className=\"grey-text\">\n                          Année de sortie\n                        </label>\n                        <input\n                          type=\"number\"\n                          name=\"year\"\n                          value={this.state.year}\n                          className=\"form-control\"\n                          placeholder=\"Année\"\n                          onChange={e => this.change(e)}\n                          \n                        />\n\n                        <br />\n                        <label htmlFor=\"date\" className=\"grey-text\">\n                          Date d&apos;achat\n                        </label>\n                        <input\n                          type=\"date\"\n                          name=\"date\"\n                          value={this.state.date}\n                          placeholder=\"jj/mm/aa\"\n                          className=\"form-control\"\n                          onChange={e => this.change(e)}\n                          \n                        />\n\n                        <br />\n\n                        <label htmlFor=\"edition\" className=\"grey-text\">\n                          Edition\n                        </label>\n                        <input\n                          type=\"text\"\n                          name=\"edition\"\n                          value={this.state.edition}\n                          placeholder=\"Edition\"\n                          className=\"form-control\"\n                          onChange={e => this.change(e)}\n                          \n                        />\n\n                        <br />\n\n                        <label htmlFor=\"typeBook\" className=\"grey-text\">\n                          Type\n                        </label>\n                        <input\n                          type=\"text\"\n                          name=\"typeBook\"\n                          value={this.state.typeBook}\n                          placeholder=\"Type\"\n                          className=\"form-control\"\n                          onChange={e => this.change(e)}\n                          \n                        />\n                        </MDBModalBody>\n                        <MDBModalFooter>\n                          <MDBBtn color=\"danger\" onClick={this.closeModalBuy}>Annuler</MDBBtn>\n                          <MDBBtn onClick={this.buyBook(this.state.year, this.state.date, this.state.edition, this.state.typeBook)} color=\"dark\">Valider l'achat</MDBBtn>\n                        </MDBModalFooter>\n                      </MDBModal>\n                    </td>\n                    <td><MDBBtn onClick={this.handleDelete(livre.id)} color=\"danger\">Supprimer</MDBBtn></td>\n                  </tr>\n                ))\n              }\n            </MDBTableBody>\n          </MDBTable>\n          <div className=\"buttonAchat\">\n                <Fragment>\n                    <MDBBtn href=\"/formulaireProchainAchat\" color=\"dark\"> \n                      Ajouter un prochain achat\n                    </MDBBtn>\n                </Fragment>\n            </div>\n        </div>\n      );\n    }\n}\n\nexport default NextPurchasePage;"]},"metadata":{},"sourceType":"module"}