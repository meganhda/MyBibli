{"ast":null,"code":"import _regeneratorRuntime from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import\"./historique.css\";import{MDBTableBody,MDBTableHead,MDBTable}from\"mdbreact\";import axios from'axios';import{Redirect}from'react-router';var Historic=/*#__PURE__*/function(_Component){_inherits(Historic,_Component);function Historic(props){var _this;_classCallCheck(this,Historic);_this=_possibleConstructorReturn(this,_getPrototypeOf(Historic).call(this,props));_this.state={noSession:false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\nloading:true,//booleen initialisé comme vrai, qui va changer lors de la récupération des données\nhistoric:[],//va contenir les anciens prêts\nerror:''//va contenir l'erreur en cas d'erreur\n};_this.checkSession=_this.checkSession.bind(_assertThisInitialized(_this));return _this;}//Vérifie que la session est active\n_createClass(Historic,[{key:\"checkSession\",value:function checkSession(){var _this2=this;axios.get(\"http://localhost:8888/API/Session/session.php\",{withCredentials:true}).then(function(response){console.log(response);}).catch(function(error){if(error.response&&error.response.status===404){_this2.setState({noSession:true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\nconsole.log(error);}});}//methode qui permet de récupérer les anciens prêts effectués via le fichier \"liste_historique.php\"\n},{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var url,response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:url=\"http://localhost:8888/API/MesLivres/liste_historique.php\";_context.next=3;return fetch(url,{credentials:'include'});case 3:response=_context.sent;_context.next=6;return response.json();case 6:data=_context.sent;this.setState({historic:data.results.livres,loading:false});//\"historic\" contient les données reçues par le back-end\nconsole.log(data.results.livres);case 9:case\"end\":return _context.stop();}}},_callee,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var noSession=this.state.noSession;//appel à la methode qui verifie la session\nthis.checkSession();//s'il n'y a pas de session active, redirection vers la page de connexion\nif(noSession){return React.createElement(Redirect,{to:\"/\"});}//si le temps de récupération des données a afficher est long\nif(this.state.loading){return React.createElement(\"div\",null,\"chargement...\");}//s'il n'y a pas de prêt déjà enregistré dans la base de données\nif(this.state.historic.length===0){return React.createElement(\"div\",null,React.createElement(\"h1\",{className:\"titleMyHistoric\"},\" Mon historique des pr\\xEAts \"),React.createElement(\"div\",{className:\"noHistoric\"},\"Aucun pr\\xEAt effectu\\xE9.\"));}//affichage d'un tableau avec les prêts déja effectués, grâce a la fonction map qui va parcourir \"historic\"\nreturn React.createElement(\"div\",null,React.createElement(\"h1\",{className:\"titleMyHistoric\"},\" Mon historique des pr\\xEAts \"),React.createElement(\"br\",null),React.createElement(MDBTable,{hover:true,bordered:true,scrollY:true,maxHeight:\"400px\"},React.createElement(MDBTableHead,null,React.createElement(\"tr\",null,React.createElement(\"th\",null,\"Titre\"),React.createElement(\"th\",null,\"Auteur\"),React.createElement(\"th\",null,\"Emprunteur\"),React.createElement(\"th\",null,\"Date d'emprunt\"),React.createElement(\"th\",null,\"Date de rendu\"))),React.createElement(MDBTableBody,null,this.state.historic.map(function(livre){return React.createElement(\"tr\",{key:livre.id},React.createElement(\"td\",null,livre.title),React.createElement(\"td\",null,livre.author),React.createElement(\"td\",null,livre.borrower),React.createElement(\"td\",null,livre.date1),React.createElement(\"td\",null,livre.date2));}))));}}]);return Historic;}(Component);export default Historic;","map":{"version":3,"sources":["/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/src/components/Historique/historique.js"],"names":["React","Component","MDBTableBody","MDBTableHead","MDBTable","axios","Redirect","Historic","props","state","noSession","loading","historic","error","checkSession","bind","get","withCredentials","then","response","console","log","catch","status","setState","url","fetch","credentials","json","data","results","livres","length","map","livre","id","title","author","borrower","date1","date2"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport \"./historique.css\";\nimport { MDBTableBody, MDBTableHead, MDBTable } from \"mdbreact\";\nimport axios from 'axios';\nimport { Redirect} from 'react-router';\n\nclass Historic extends Component{\n\n    constructor(props){\n        super(props);\n        this.state = {\n            noSession: false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\n            loading: true,//booleen initialisé comme vrai, qui va changer lors de la récupération des données\n            historic: [],//va contenir les anciens prêts\n            error: '',//va contenir l'erreur en cas d'erreur\n        }\n        this.checkSession = this.checkSession.bind(this);\n    }\n\n    //Vérifie que la session est active\n    checkSession () {\n        axios.get(\"http://localhost:8888/API/Session/session.php\", {withCredentials: true})\n\n        .then(function(response){\n        console.log(response);\n        })\n\n        .catch((error) => {\n            if(error.response && error.response.status=== 404){\n                this.setState({noSession: true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\n                console.log(error);\n            }\n        });\n    }\n\n    //methode qui permet de récupérer les anciens prêts effectués via le fichier \"liste_historique.php\"\n    async componentDidMount() {\n        const url = \"http://localhost:8888/API/MesLivres/liste_historique.php\";\n        const response = await fetch(url,{credentials: 'include'});\n        const data = await response.json();\n        this.setState({historic: data.results.livres, loading: false})//\"historic\" contient les données reçues par le back-end\n        console.log(data.results.livres);\n      }\n\n\n    render() {\n\n        const {noSession} = this.state;\n\n         //appel à la methode qui verifie la session\n         this.checkSession ();\n\n         //s'il n'y a pas de session active, redirection vers la page de connexion\n         if(noSession){\n           return <Redirect to=\"/\"/>;\n         }\n\n        //si le temps de récupération des données a afficher est long\n        if(this.state.loading){\n            return <div>chargement...</div>;\n        }\n\n        //s'il n'y a pas de prêt déjà enregistré dans la base de données\n        if (this.state.historic.length === 0){\n            return (\n              <div>\n                <h1 className=\"titleMyHistoric\"> Mon historique des prêts </h1>\n                <div className=\"noHistoric\">\n                  Aucun prêt effectué.\n                </div>\n              </div>  \n            );\n        } \n\n        //affichage d'un tableau avec les prêts déja effectués, grâce a la fonction map qui va parcourir \"historic\"\n        return(\n            <div> \n\n                <h1 className=\"titleMyHistoric\"> Mon historique des prêts </h1>\n\n                <br></br>\n\n                <MDBTable hover bordered scrollY maxHeight=\"400px\">\n                    <MDBTableHead>\n                    <tr>\n                    <th>Titre</th>\n                    <th>Auteur</th>\n                    <th>Emprunteur</th>\n                    <th>Date d'emprunt</th>\n                    <th>Date de rendu</th>\n                    </tr>\n                    </MDBTableHead>\n                    <MDBTableBody>\n                    {\n                        this.state.historic.map(livre => (\n                        <tr key={livre.id} >\n                            <td>{livre.title}</td>\n                            <td>{livre.author}</td>\n                            <td>{livre.borrower}</td>\n                            <td>{livre.date1}</td>\n                            <td>{livre.date2}</td>\n                        </tr>\n                        ))\n                    }\n                    </MDBTableBody>\n                </MDBTable>\n\n            </div>\n        );\n    }\n}\n        \n export default Historic;\n        "]},"metadata":{},"sourceType":"module"}