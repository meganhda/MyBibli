{"ast":null,"code":"import _regeneratorRuntime from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import{MDBTable,MDBTableBody,MDBTableHead,MDBBtn,MDBModal,MDBModalHeader,MDBModalBody,MDBModalFooter}from'mdbreact';import'./mesLivres.css';import axios from'axios';import{Redirect}from'react-router';var MyBooks=/*#__PURE__*/function(_React$Component){_inherits(MyBooks,_React$Component);function MyBooks(props){var _this;_classCallCheck(this,MyBooks);_this=_possibleConstructorReturn(this,_getPrototypeOf(MyBooks).call(this,props));_this.openModalBook=function(id,title,author,year,date,edition,typeBook){return function(e){_this.setState({modal:true,idBook:id,title:title,author:author,year:year,date:date,edition:edition,typeBook:typeBook});};};_this.closeModalBook=function(){_this.setState({modal:false});};_this.change=function(e){_this.setState(_defineProperty({},e.target.name,e.target.value));};_this.editBook=function(title,author,year,date,edition,typeBook){return function(e){var _this$state=_this.state,idBook=_this$state.idBook,books=_this$state.books;var newBooks=books;console.log(idBook,'idBookSubmit');_this.setState({modal:false});var formData=new FormData();formData.append(\"id\",idBook);formData.append(\"title\",title);formData.append(\"author\",author);formData.append(\"year\",year);formData.append(\"date\",date);formData.append(\"edition\",edition);formData.append(\"typeBook\",typeBook);var url=\"http://localhost:8888/API/MesLivres/modif_livre.php\";axios.post(url,formData,{withCredentials:true})//succes modification livre\n.then(function(response){console.log(response.status,response);alert('Modifications enregistrées, veuillez recharger la page');var tmp=books;newBooks=tmp.filter(function(livre){return livre.id!==idBook;});})//echec modification livre\n.catch(function(error){console.log(error);if(error.response&&error.response.status===403){console.log(error);alert('Echec modification');}});setTimeout(function(){_this.setState({books:newBooks});},500);setTimeout(function(){_this.setState({error:''});},2000);e.preventDefault();};};_this.handleDelete=function(id){return function(e){var books=_this.state.books;var newBooks=books;var formData=new FormData();formData.append(\"id\",id);var url=\"http://localhost:8888/API/MesLivres/supprimer_livre.php\";axios.post(url,formData,{withCredentials:true})//succes suppression livre\n.then(function(response){console.log(response);var tmp=books;newBooks=tmp.filter(function(livre){return livre.id!==id;});alert('Livre supprimé de votre bibliothèque');})//echec suppression livre\n.catch(function(error){console.log(error);if(error.response.status===403){console.log(error);alert('Echec de la suppression');}});setTimeout(function(){_this.setState({books:newBooks});},500);setTimeout(function(){_this.setState({error:''});},2000);e.preventDefault();};};_this.state={noSession:false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\nloading:true,//booleen initialisé comme vrai, qui va changer lors de la récupération des données\nbooks:[],//va contenir les livres de l'utilisateur\nmodal:false,//booleen qui va permettre d'ouvrir/fermer une fenetre lorsque l'utilisateur appuie sur \"modifier\"\ntitle:'',//va contenir la valeur entrée pour le champs \"titre\" du formulaire de modification\nauthor:'',//va contenir la valeur entrée pour le champs \"auteur\" du formulaire de modification\nyear:'',//va contenir la valeur entrée pour le champs \"année de sortie\" du formulaire de modification\ndate:'',//va contenir la valeur entrée pour le champs \"date d'achat\" du formulaire de modification\nedition:'',//va contenir la valeur entrée pour le champs \"edition\" du formulaire de modification\ntypeBook:'',//va contenir la valeur entrée pour le champs \"type\" du formulaire de modification\nid:'',//va contenir l'id du livre selectionné par l'utilisateur lorsqu'il appuiera sur les boutons \"modifier\"/\"supprimer\"\nerror:'',//va contenir l'erreur en cas d'erreur\nidBook:null//va contenir l'id du livre a modifier\n};_this.checkSession=_this.checkSession.bind(_assertThisInitialized(_this));_this.handleDelete=_this.handleDelete.bind(_assertThisInitialized(_this));_this.editBook=_this.editBook.bind(_assertThisInitialized(_this));_this.openModalBook=_this.openModalBook.bind(_assertThisInitialized(_this));return _this;}//Vérifie que la session est active\n_createClass(MyBooks,[{key:\"checkSession\",value:function checkSession(){var _this2=this;axios.get(\"http://localhost:8888/API/Session/session.php\",{withCredentials:true}).then(function(response){console.log(response);}).catch(function(error){if(error.response&&error.response.status===404){_this2.setState({noSession:true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\nconsole.log(error);}});}//methode qui permet d'ouvrir une fenetre contenant un formulaire pré-rempli des informations du livre selectionné par l'utilisateur, lorsque celui-ci appuie sur \"modifier\"\n},{key:\"componentDidMount\",//methode qui permet de récuperer les livres de l'utilisateur via le fichier \"liste_livres.php\"\nvalue:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var url,response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:url=\"http://localhost:8888/API/MesLivres/liste_livres.php\";_context.next=3;return fetch(url,{credentials:'include'});case 3:response=_context.sent;_context.next=6;return response.json();case 6:data=_context.sent;this.setState({books:data.results.livres,loading:false});//\"books\" contient les données reçues par le back-end et booleen \"loading\" changé comme \"faux\"\nconsole.log(data.results.livres);case 9:case\"end\":return _context.stop();}}},_callee,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this3=this;var noSession=this.state.noSession;//appel à la methode qui verifie la session\nthis.checkSession();//s'il n'y a pas de session active, redirection vers la page de connexion\nif(noSession){return React.createElement(Redirect,{to:\"/\"});}//si le temps de récupération des données a afficher est long\nif(this.state.loading){return React.createElement(\"div\",null,\"chargement...\");}//si l'utilisateur n'a pas de livres deja ajoutés a sa bibliotheque\nif(this.state.books.length===0){return React.createElement(\"div\",null,React.createElement(\"h1\",{className:\"myBibli\"},\" Mes livres \"),React.createElement(\"div\",{className:\"noBook\"},\"Vous n'avez actuellement aucun livre dans votre biblioth\\xE8que.\"));}//sinon:\n//affichage d'un tableau avec les livres de l'utilisateur, grâce a la fonction map qui va parcourir \"books\"\n//affichage des boutons \"supprimer\" et \"modifier\" sur chaque ligne du tableau\n//ouverture d'une fenetre avec le formulaire de modification \nreturn React.createElement(\"div\",null,React.createElement(\"h1\",{className:\"myBibli\"},\" Mes livres \"),React.createElement(\"br\",null),React.createElement(\"h2\",null,\" Vous avez \",this.state.books.length,\" livre(s) dans votre biblioth\\xE8que:\"),React.createElement(\"br\",null),React.createElement(MDBTable,{hover:true,bordered:true,scrollY:true,maxHeight:\"400px\"},React.createElement(MDBTableHead,null,React.createElement(\"tr\",null,React.createElement(\"th\",null,\"Titre\"),React.createElement(\"th\",null,\"Auteur\"),React.createElement(\"th\",null,\"Ann\\xE9e de sortie\"),React.createElement(\"th\",null,\"Date d'achat\"),React.createElement(\"th\",null,\"Edition\"),React.createElement(\"th\",null,\"Type\"),React.createElement(\"th\",null,\"Statut\"),React.createElement(\"th\",null),React.createElement(\"th\",null))),React.createElement(MDBTableBody,null,this.state.books.map(function(livre){return React.createElement(\"tr\",{key:livre.id},React.createElement(\"td\",null,livre.title),React.createElement(\"td\",null,livre.author),React.createElement(\"td\",null,livre.year),React.createElement(\"td\",null,livre.date),React.createElement(\"td\",null,livre.edition),React.createElement(\"td\",null,livre.typeBook),React.createElement(\"td\",null,livre.status),React.createElement(\"td\",null,React.createElement(MDBBtn,{onClick:_this3.openModalBook(livre.id,livre.title,livre.author,livre.year,livre.date,livre.edition,livre.typeBook),color:\"dark\"},\"Modifier\"),React.createElement(MDBModal,{isOpen:_this3.state.modal},React.createElement(MDBModalHeader,null,\"Modifications du livre\"),React.createElement(MDBModalBody,null,React.createElement(\"label\",{htmlFor:\"title\",className:\"grey-text\"},\"Titre\"),React.createElement(\"input\",{type:\"text\",name:\"title\",value:_this3.state.title,className:\"form-control\",onChange:function onChange(e){return _this3.change(e);}}),React.createElement(\"br\",null),React.createElement(\"label\",{htmlFor:\"author\",className:\"grey-text\"},\"Auteur\"),React.createElement(\"input\",{type:\"text\",name:\"author\",value:_this3.state.author,className:\"form-control\",onChange:function onChange(e){return _this3.change(e);}}),React.createElement(\"br\",null),React.createElement(\"label\",{htmlFor:\"year\",className:\"grey-text\"},\"Ann\\xE9e de sortie\"),React.createElement(\"input\",{type:\"number\",name:\"year\",className:\"form-control\",value:_this3.state.year,onChange:function onChange(e){return _this3.change(e);}}),React.createElement(\"br\",null),React.createElement(\"label\",{htmlFor:\"date\",className:\"grey-text\"},\"Date d'achat\"),React.createElement(\"input\",{type:\"date\",name:\"date\",value:_this3.state.date,className:\"form-control\",onChange:function onChange(e){return _this3.change(e);}}),React.createElement(\"br\",null),React.createElement(\"label\",{htmlFor:\"edition\",className:\"grey-text\"},\"Edition\"),React.createElement(\"input\",{type:\"text\",name:\"edition\",value:_this3.state.edition,className:\"form-control\",onChange:function onChange(e){return _this3.change(e);}}),React.createElement(\"br\",null),React.createElement(\"label\",{htmlFor:\"typeBook\",className:\"grey-text\"},\"Type\"),React.createElement(\"input\",{type:\"text\",name:\"typeBook\",value:_this3.state.typeBook,className:\"form-control\",onChange:function onChange(e){return _this3.change(e);}})),React.createElement(MDBModalFooter,null,React.createElement(MDBBtn,{color:\"danger\",onClick:_this3.closeModalBook},\"Annuler\"),React.createElement(MDBBtn,{onClick:_this3.editBook(_this3.state.title,_this3.state.author,_this3.state.year,_this3.state.date,_this3.state.edition,_this3.state.typeBook),color:\"dark\"},\"Enregistrer\")))),React.createElement(\"td\",null,React.createElement(MDBBtn,{onClick:_this3.handleDelete(livre.id),color:\"danger\"},\"Supprimer\")));}))));}}]);return MyBooks;}(React.Component);export default MyBooks;","map":{"version":3,"sources":["/Users/Megane/MonProjet/2019-l2aj2/trunk/2019-l2aj2/APP_Mac/src/components/MesLivres/mesLivres.js"],"names":["React","MDBTable","MDBTableBody","MDBTableHead","MDBBtn","MDBModal","MDBModalHeader","MDBModalBody","MDBModalFooter","axios","Redirect","MyBooks","props","openModalBook","id","title","author","year","date","edition","typeBook","e","setState","modal","idBook","closeModalBook","change","target","name","value","editBook","state","books","newBooks","console","log","formData","FormData","append","url","post","withCredentials","then","response","status","alert","tmp","filter","livre","catch","error","setTimeout","preventDefault","handleDelete","noSession","loading","checkSession","bind","get","fetch","credentials","json","data","results","livres","length","map","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { MDBTable, MDBTableBody, MDBTableHead, MDBBtn, MDBModal, MDBModalHeader, MDBModalBody,MDBModalFooter, } from 'mdbreact';\nimport './mesLivres.css';\nimport axios from 'axios';\nimport { Redirect} from 'react-router';\n\nclass MyBooks extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      noSession: false,//booleen qui permet de verifier si la session de l'utilisateur est active, initialisé a \"faux\"\n      loading: true,//booleen initialisé comme vrai, qui va changer lors de la récupération des données\n      books: [],//va contenir les livres de l'utilisateur\n      modal: false,//booleen qui va permettre d'ouvrir/fermer une fenetre lorsque l'utilisateur appuie sur \"modifier\"\n      title: '',//va contenir la valeur entrée pour le champs \"titre\" du formulaire de modification\n      author: '',//va contenir la valeur entrée pour le champs \"auteur\" du formulaire de modification\n      year: '',//va contenir la valeur entrée pour le champs \"année de sortie\" du formulaire de modification\n      date: '',//va contenir la valeur entrée pour le champs \"date d'achat\" du formulaire de modification\n      edition: '',//va contenir la valeur entrée pour le champs \"edition\" du formulaire de modification\n      typeBook: '',//va contenir la valeur entrée pour le champs \"type\" du formulaire de modification\n      id: '',//va contenir l'id du livre selectionné par l'utilisateur lorsqu'il appuiera sur les boutons \"modifier\"/\"supprimer\"\n      error: '',//va contenir l'erreur en cas d'erreur\n      idBook: null,//va contenir l'id du livre a modifier\n    }\n    this.checkSession = this.checkSession.bind(this);\n    this.handleDelete = this.handleDelete.bind(this);\n    this.editBook = this.editBook.bind(this);\n    this.openModalBook = this.openModalBook.bind(this);\n  }\n\n  //Vérifie que la session est active\n  checkSession () {\n    axios.get(\"http://localhost:8888/API/Session/session.php\", {withCredentials: true})\n\n    .then(function(response){\n      console.log(response);\n    })\n\n    .catch((error) => {\n      if(error.response && error.response.status=== 404){\n        this.setState({noSession: true});//s'il n'y a pas de session active, change la valeur du booleen comme \"vrai\"\n        console.log(error);\n      }\n    });\n  }\n\n  //methode qui permet d'ouvrir une fenetre contenant un formulaire pré-rempli des informations du livre selectionné par l'utilisateur, lorsque celui-ci appuie sur \"modifier\"\n  openModalBook = (id, title, author, year, date, edition, typeBook) => e => {\n    this.setState({\n      modal: true,\n      idBook: id,\n      title: title,\n      author: author,\n      year: year,\n      date: date,\n      edition: edition,\n      typeBook: typeBook\n    });\n  }\n\n  //methode qui permet de fermer la fenetre de modification, lorsque l'utilisateur appuie sur \"annuler\"\n  closeModalBook = () => {\n  this.setState({\n    modal: false,\n    });\n  }\n\n  //methode qui permet d'attribuer à \"title\", \"author\", \"year\", \"date\", \"edition\" et \"typeBook\" les nouvelles valeurs entrées au clavier par l'utilisateur lors de la modification d'un livre\n  change = e => {\n    this.setState ({\n      [e.target.name]: e.target.value\n    });\n  };\n\n  //methode qui permet d'envoyer les données au fichier PHP \"modif_livre.php\" afin d'enregistrer les nouvelles donnees d'un livre, lorque l'utilisateur appuie sur le bouton \"enregistrer\" de la fenetre de modification\n  editBook = (title, author, year, date, edition, typeBook) => e => {\n    const { idBook, books } = this.state;\n    let newBooks = books;\n    console.log(idBook,'idBookSubmit');\n    this.setState({\n      modal: false,\n    })\n    let formData = new FormData();\n    formData.append(\"id\",idBook);\n    formData.append(\"title\",title);\n    formData.append(\"author\",author);\n    formData.append(\"year\",year);\n    formData.append(\"date\",date);\n    formData.append(\"edition\",edition);\n    formData.append(\"typeBook\",typeBook);\n    const url = \"http://localhost:8888/API/MesLivres/modif_livre.php\"\n    axios.post(url, formData, {withCredentials: true})\n    \n    //succes modification livre\n    .then(function(response){\n      console.log(response.status, response)\n      alert('Modifications enregistrées, veuillez recharger la page');\n      const tmp = books;\n      newBooks = tmp.filter(livre => livre.id !== idBook);\n    })\n\n    //echec modification livre\n    .catch((error)=>{\n      console.log(error)\n      if (error.response && error.response.status === 403){\n        console.log(error);\n        alert('Echec modification');\n      }\n    });\n    \n    setTimeout(() => {\n      this.setState({\n        books: newBooks\n      })\n    }, 500);\n\n    setTimeout(() => {\n      this.setState({\n        error: '',\n      });\n    }, 2000);\n          \n    e.preventDefault();\n  }\n\n  //methode qui permet d'envoyer au fichier PHP \"supprimer_livre.php\" l'id du livre a supprimer, lorsque l'utilisateur appuie sur le bouton \"supprimer\"\n  handleDelete = (id) => e => {\n    const { books } = this.state;\n    let newBooks = books;\n    let formData = new FormData();\n    formData.append(\"id\",id);\n    const url = \"http://localhost:8888/API/MesLivres/supprimer_livre.php\"\n    axios.post(url, formData, {withCredentials: true})\n    \n    //succes suppression livre\n    .then(function(response){\n      console.log(response);\n      const tmp = books;\n      newBooks = tmp.filter(livre => livre.id !== id);\n      alert('Livre supprimé de votre bibliothèque');\n    })\n\n    //echec suppression livre\n    .catch((error)=>{\n      console.log(error)\n      if (error.response.status === 403){\n        console.log(error);\n        alert('Echec de la suppression');\n      }\n    });\n\n    setTimeout(() => {\n      this.setState({\n        books: newBooks\n      })\n    }, 500);\n    \n\n    setTimeout(() => {\n      this.setState({\n        error: '',\n      });\n    }, 2000);\n          \n    e.preventDefault();\n  }\n\n\n  //methode qui permet de récuperer les livres de l'utilisateur via le fichier \"liste_livres.php\"\n  async componentDidMount() {\n    const url = \"http://localhost:8888/API/MesLivres/liste_livres.php\";\n\n    const response = await fetch(url,{credentials: 'include'});\n    const data = await response.json();\n    this.setState({books: data.results.livres, loading: false})//\"books\" contient les données reçues par le back-end et booleen \"loading\" changé comme \"faux\"\n    console.log(data.results.livres);\n  }\n\n\n  \n  render() {\n    const {noSession} = this.state;\n\n     //appel à la methode qui verifie la session\n     this.checkSession ();\n\n     //s'il n'y a pas de session active, redirection vers la page de connexion\n     if(noSession){\n       return <Redirect to=\"/\"/>;\n     }\n\n    //si le temps de récupération des données a afficher est long\n    if(this.state.loading){\n      return <div>chargement...</div>;\n    }\n\n    //si l'utilisateur n'a pas de livres deja ajoutés a sa bibliotheque\n    if (this.state.books.length === 0){\n      return (\n        <div>\n          <h1 className=\"myBibli\"> Mes livres </h1>\n          <div className=\"noBook\">\n            Vous n'avez actuellement aucun livre dans votre bibliothèque.\n          </div>\n        </div>\n      );\n    }\n\n    //sinon:\n    //affichage d'un tableau avec les livres de l'utilisateur, grâce a la fonction map qui va parcourir \"books\"\n    //affichage des boutons \"supprimer\" et \"modifier\" sur chaque ligne du tableau\n    //ouverture d'une fenetre avec le formulaire de modification \n    return (\n      <div>\n        <h1 className=\"myBibli\"> Mes livres </h1>\n        <br></br>\n        <h2> Vous avez {this.state.books.length} livre(s) dans votre bibliothèque:</h2>\n        <br></br>\n        <MDBTable hover bordered scrollY maxHeight=\"400px\">\n          <MDBTableHead>\n            <tr>\n            <th>Titre</th>\n            <th>Auteur</th>\n            <th>Année de sortie</th>\n            <th>Date d'achat</th>\n            <th>Edition</th>\n            <th>Type</th>\n            <th>Statut</th>\n            <th></th>\n            <th></th>\n            </tr>\n          </MDBTableHead>\n          <MDBTableBody>\n            {\n              this.state.books.map(livre => (\n                <tr key={livre.id} >\n                  <td>{livre.title}</td>\n                  <td>{livre.author}</td>\n                  <td>{livre.year}</td>\n                  <td>{livre.date}</td>\n                  <td>{livre.edition}</td>\n                  <td>{livre.typeBook}</td>\n                  <td>{livre.status}</td>\n                  <td><MDBBtn onClick={this.openModalBook(livre.id, livre.title, livre.author, livre.year, livre.date, livre.edition, livre.typeBook)} color=\"dark\">Modifier</MDBBtn>\n                    <MDBModal isOpen={this.state.modal}>\n                      <MDBModalHeader>Modifications du livre</MDBModalHeader>\n                      <MDBModalBody>\n                      <label htmlFor=\"title\" className=\"grey-text\">\n                            Titre\n                          </label>\n                          <input\n                            type=\"text\"\n                            name=\"title\"\n                            value={this.state.title}\n                            className=\"form-control\"\n                            onChange={e => this.change(e)}\n\n                            />\n\n                            <br/>\n\n                            <label htmlFor=\"author\" className=\"grey-text\">\n                            Auteur\n                          </label>\n                          <input\n                            type=\"text\"\n                            name=\"author\"\n                            value={this.state.author}\n                            className=\"form-control\"\n                            onChange={e => this.change(e)}\n\n                            />\n\n                            <br/>\n\n\n                      <label htmlFor=\"year\" className=\"grey-text\">\n                            Année de sortie\n                          </label>\n                          <input\n                            type=\"number\"\n                            name=\"year\" \n                            className=\"form-control\"\n                            value={this.state.year}\n                            onChange={e => this.change(e)}\n                            \n                          />\n\n                          <br />\n\n                          <label htmlFor=\"date\" className=\"grey-text\">\n                            Date d&apos;achat\n                          </label>\n                          <input\n                            type=\"date\"\n                            name=\"date\"\n                            value={this.state.date}\n                            className=\"form-control\"\n                            onChange={e => this.change(e)}\n                            \n                          />\n\n                          <br />\n\n                          <label htmlFor=\"edition\" className=\"grey-text\">\n                            Edition\n                          </label>\n                          <input\n                            type=\"text\"\n                            name=\"edition\"\n                            value={this.state.edition}\n                            className=\"form-control\"\n                            onChange={e => this.change(e)}\n                            \n                          />\n\n                          <br />\n\n                          <label htmlFor=\"typeBook\" className=\"grey-text\">\n                            Type\n                          </label>\n                          <input\n                            type=\"text\"\n                            name=\"typeBook\"\n                            value={this.state.typeBook}\n                            className=\"form-control\"\n                            onChange={e => this.change(e)}\n                            \n                          />\n                      </MDBModalBody>\n                      <MDBModalFooter>\n                        <MDBBtn color=\"danger\" onClick={this.closeModalBook}>Annuler</MDBBtn>\n                        <MDBBtn onClick={this.editBook(this.state.title, this.state.author, this.state.year, this.state.date, this.state.edition, this.state.typeBook)} color=\"dark\">Enregistrer</MDBBtn>\n                      </MDBModalFooter>\n                    </MDBModal>\n                  \n                  </td>\n                  <td><MDBBtn onClick={this.handleDelete(livre.id)} color=\"danger\">Supprimer</MDBBtn></td>\n                </tr>\n              ))\n            }\n          </MDBTableBody>\n        </MDBTable>\n\n      </div>\n    );\n  }\n}\n\nexport default MyBooks;"]},"metadata":{},"sourceType":"module"}